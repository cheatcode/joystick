import n from"../../accounts/index.js";import _ from"../../accounts/default_user_output_fields.js";import c from"../format_api_error.js";import i from"../handle_api_error.js";import d from"../validate_input.js";const u=async(t={},a={})=>{try{const s=process.joystick?.app_options?.accounts?.signup?.metadata,r=s?await d(t?.body?.metadata,s):[];if(r?.length>0)return i("accounts.signup",{errors:r.map(p=>c(new Error(p),"accounts.signup.metadata",401))},a);const o=await n.signup({email_address:t?.body?.emailAddress||t?.body?.email_address,password:t?.body?.password,metadata:t?.body?.metadata,output:t?.body?.output||_});process.env.NODE_ENV!=="test"&&n._set_account_cookie(a,{token:o?.token,token_expires_at:o?.token_expires_at});const e={...o?.user||{}};process.env.NODE_ENV==="test"&&(e.joystick_token=o?.token,e.joystick_login_token_expires_at=o?.token_expires_at),a.status(200).send(JSON.stringify(e))}catch(s){i("accounts.signup",s,a)}};var l=u;export{l as default};
