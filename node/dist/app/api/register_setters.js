import f from"./format_api_error.js";import d from"./get_api_context.js";import l from"./get_api_url_component.js";import g from"./handle_api_error.js";import y from"./set.js";import h from"../../lib/types.js";import w from"./validate_cookie_session.js";import x from"../settings/load.js";const v=x(),b=(a={},n=[],p={},_={})=>{for(let e=0;e<n?.length;e+=1){const[r,i]=n[e];a.post(`/api/_setters/${l(r)}`,...h.is_array(i?.middleware)?i?.middleware:[],async(o={},t={})=>{if(v?.config?.sessions?.secret&&!await w(o,t))return t.status(403).send(JSON.stringify({errors:[f(new Error("Unauthorized request."))]}));const m=await d(o,t,p),c=o?.body?.input||null,u=o?.body?.output||null;y({set_name:r,set_options:{input:c,output:u},setter_definition:i,request_context:m,api_schema_options:_}).then(s=>t.status(200).send(JSON.stringify(s))).catch(s=>{g(`api.setters.${r}`,s,t)})})}};var U=b;export{U as default};
