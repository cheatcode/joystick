import d from"./format_api_error.js";import f from"./get_api_context.js";import l from"./get_api_url_component.js";import y from"./handle_api_error.js";import g from"./set.js";import h from"../../lib/types.js";import w from"./validate_cookie_session.js";const x=(a={},n=[],p={},_={})=>{for(let e=0;e<n?.length;e+=1){const[r,i]=n[e];a.post(`/api/_setters/${l(r)}`,...h.is_array(i?.middleware)?i?.middleware:[],async(o={},t={})=>{if(process.databases?._sessions&&!await w(o,t))return t.status(403).send(JSON.stringify({errors:[d(new Error("Unauthorized request."))]}));const m=await f(o,t,p),u=o?.body?.input||null,c=o?.body?.output||null;g({set_name:r,set_options:{input:u,output:c},setter_definition:i,request_context:m,api_schema_options:_}).then(s=>t.status(200).send(JSON.stringify(s))).catch(s=>{y(`api.setters.${r}`,s,t)})})}};var k=x;export{k as default};
