import g from"./format_api_error.js";import y from"./get.js";import h from"./get_api_context.js";import w from"./get_api_url_component.js";import v from"./handle_api_error.js";import _ from"../../lib/is_valid_json.js";import x from"../../lib/types.js";import J from"./validate_session.js";const N=(d={},n=[],m={},u={})=>{for(let r=0;r<n?.length;r+=1){const[s,i]=n[r];d.get(`/api/_getters/${w(s)}`,...x.is_array(i?.middleware)?i?.middleware:[],async(e={},t={})=>{if(process.databases?._sessions&&!await J(e,t))return t.status(403).send(JSON.stringify({errors:[g(new Error("Unauthorized request."))]}));const c=await h(e,t,m),a=decodeURIComponent(e?.query?.input),f=_(a)?JSON.parse(a):null,p=decodeURIComponent(e?.query?.output),l=_(p)?JSON.parse(p):null;y({get_name:s,get_options:{input:f,output:l},getter_definition:i,request_context:c,api_schema_options:u}).then(o=>t.status(200).send(JSON.stringify(o))).catch(o=>{v(`api.getters.${s}`,o,t)})})}};var j=N;export{j as default};
