import l from"./format_api_error.js";import y from"./get.js";import h from"./get_api_context.js";import w from"./get_api_url_component.js";import v from"./handle_api_error.js";import _ from"../../lib/is_valid_json.js";import x from"../../lib/types.js";import J from"./validate_cookie_session.js";import N from"../settings/load.js";const O=N(),S=(m={},n=[],d={},c={})=>{for(let r=0;r<n?.length;r+=1){const[i,s]=n[r];m.get(`/api/_getters/${w(i)}`,...x.is_array(s?.middleware)?s?.middleware:[],async(e={},t={})=>{if(O?.config?.sessions?.secret&&!await J(e,t))return t.status(403).send(JSON.stringify({errors:[l(new Error("Unauthorized request."))]}));const u=await h(e,t,d),a=decodeURIComponent(e?.query?.input),f=_(a)?JSON.parse(a):null,p=decodeURIComponent(e?.query?.output),g=_(p)?JSON.parse(p):null;y({get_name:i,get_options:{input:f,output:g},getter_definition:s,request_context:u,api_schema_options:c}).then(o=>t.status(200).send(JSON.stringify(o))).catch(o=>{v(`api.getters.${i}`,o,t)})})}};var E=S;export{E as default};
