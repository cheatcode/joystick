import t from"../databases/queries/sessions.js";import a from"../../lib/set_cookie.js";import c from"../settings/load.js";const _=async(s,n,i)=>{const o=s?.headers?.["x-push-instance-token"];if(o&&c()?.private?.cheatcode?.is_push&&await process.databases.mongodb.collection("instances").findOne({token:{$eq:o}})||s?.url?.includes("/api/_push/health"))return i();let e=s?.cookies?.joystick_session;(e?await t("get_session",{session_id:e}):null)||(e=await t("create_session"),a(n,{name:"joystick_session",value:e,http_only:!0})),s.cookies={...s?.cookies||{},joystick_session:e},s.context={...s?.context||{},session:await t("get_session",{session_id:e})},i()};var k=_;export{k as default};
