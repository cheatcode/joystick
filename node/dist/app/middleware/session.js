import o from"../databases/queries/sessions.js";import c from"../../lib/set_cookie.js";import a from"../settings/load.js";const _=async(s,n,e)=>{const t=s?.headers?.["x-push-instance-token"];if(t&&a()?.private?.cheatcode?.is_push&&await process.databases.mongodb.collection("instances").findOne({token:{$eq:t}})||s?.url?.includes("/api/_push/health"))return e();let i=s?.cookies?.joystick_session;(i?await o("get_session",{session_id:i}):null)||(i=await o("create_session"),c(n,"joystick_session",i)),s.cookies={...s?.cookies||{},joystick_session:i},s.context={...s?.context||{},session:await o("get_session",{session_id:i})},e()};var k=_;export{k as default};
