import a from"compression";import _ from"cookie-parser";import c from"cors";import i from"express";import m from"serve-favicon";import t from"./account.js";import d from"./body_parser.js";import u from"./build_error.js";import f from"./context.js";import l from"../../lib/get_joystick_build_path.js";import x from"./hmr_client.js";import o from"./insecure.js";import b from"../../lib/path_exists.js";import w from"./process_browser_polyfill.js";import y from"./render/index.js";import j from"./request_methods.js";import v from"./session.js";const k=l(),n=(e={})=>{e.express_app.set("trust proxy",1),["development","test"].includes(process.env.NODE_ENV)||e.express_app.use(o),e.express_app.use(u),e.express_app.use(j),e?.csp_config&&e.express_app.use((r,p,s)=>csp(r,p,s,e?.csp_config)),process.env.NODE_ENV!=="development"&&e.express_app.use(a()),e.express_app.use(i.static("public")),e.express_app.use("/css",i.static("css")),e.express_app.use("/_joystick/utils/process.js",w),e.express_app.use("/_joystick/index.client.js",i.static(`${e?.joystick_build_path}index.client.js`)),e.express_app.use("/_joystick/index.css",i.static(`${e?.joystick_build_path}index.css`)),e.express_app.use("/_joystick/ui",i.static(`${k}ui`)),process.env.NODE_ENV==="development"&&e.express_app.use("/_joystick/hmr/client.js",x),e.express_app.use(async(r,p,s)=>{await b("public/favicon.ico")?m("public/favicon.ico")(r,p,s):s()}),e.express_app.use(_()),e.express_app.use(d(e?.middleware_config?.bodyParser)),e.express_app.use(c(e?.middleware_config?.cors,e?.port)),process.databases?._sessions&&e.express_app.use((r,p,s)=>v(r,p,s)),process.databases?._users&&e.express_app.use((r,p,s)=>t(r,p,s)),e.express_app.use((r,p,s)=>f(r,p,s)),e.express_app.use((r,p,s)=>y(r,p,s,e?.app_instance))};var J=n;export{J as default};
