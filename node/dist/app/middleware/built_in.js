import a from"compression";import c from"cookie-parser";import i from"cors";import _ from"express";import m from"serve-favicon";import t from"./account.js";import d from"./body_parser.js";import u from"./build_error.js";import f from"./csp.js";import l from"./context.js";import o from"./detect_device_type.js";import x from"../../lib/get_joystick_build_path.js";import b from"./hmr_client.js";import w from"./insecure.js";import h from"../../lib/path_exists.js";import v from"./process_browser_polyfill.js";import y from"./render/index.js";import g from"./request_methods.js";import j from"./session.js";const Q=x(),k=(e={})=>{if(e.express_app.set("trust proxy",1),e.express_app.use(u),["development","test"].includes(process.env.NODE_ENV)||e.express_app.use(w),e?.csp_config&&e.express_app.use((s,r,p)=>f(s,r,p,e?.csp_config)),process.env.NODE_ENV!=="development"&&e.express_app.use(a()),e.express_app.use(_.static("public")),e.express_app.use("/_joystick/utils/process.js",v),e.express_app.use("/_joystick",_.static(e?.joystick_build_path)),e.express_app.use("/css",_.static("css")),e.express_app.use("/_joystick/css",_.static("css")),e.express_app.use(async(s,r,p)=>{await h("public/favicon.ico")?m("public/favicon.ico")(s,r,p):p()}),e.express_app.use(c()),e.express_app.use(d(e?.middleware_config?.bodyParser)),e.express_app.use(i(e?.middleware_config?.cors,e?.port)),e.express_app.use(g),e.express_app.use((s,r,p)=>{s.device=o(s),p()}),process.databases?._sessions&&e.express_app.use((s,r,p)=>j(s,r,p)),process.databases?._users&&e.express_app.use((s,r,p)=>t(s,r,p)),e.express_app.use((s,r,p)=>l(s,r,p)),e?.middleware_config?.public_paths?.length>0)for(let s=0;s<e?.middleware_config?.public_paths?.length;s+=1){const r=e?.middleware_config?.public_paths[s];e.express_app.use(r?.route,_.static(r?.directory))}e.express_app.use((s,r,p)=>y(s,r,p,e?.app_instance)),process.env.NODE_ENV==="development"&&e.express_app.use("/_joystick/hmr/client.js",b)};var R=k;export{R as default};
