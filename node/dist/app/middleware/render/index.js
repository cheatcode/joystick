import k from"fs";import i from"../generate_joystick_error_page.js";import j from"../../../lib/get_joystick_build_path.js";import b from"../../../lib/get_translations.js";import $ from"./get_url.js";import w from"../../ssr/index.js";import u from"../../../lib/strip_preceeding_slash.js";const{readFile:E}=k.promises,z=j(),A=(o,s,_,e={})=>{s.render=async(l="",t={})=>{const m=u(l),c=u(t?.layout),n=m,a=t?.layout?c:null;if(!process._joystick_components[n])return s.status(404).send(i({type:"page_not_found",path:`res.render('${n}')`,frame:null,stack:`A page component at the path ${n} could not be found.`}));if(a&&!process._joystick_components[a])return s.status(404).send(i({type:"layout_not_found",path:`res.render('${n}', { layout: '${c}' })`,frame:null,stack:`A layout component at the path ${t?.layout} could not be found.`}));const r=process._joystick_components[n],h=a?process._joystick_components[a]:null,p={...t?.props||{},theme:o?.cookies?.theme||"light"};a&&(p.page=r);const d=process._joystick_html,f=await b({language_files:process._joystick_translations?.normal?.files||[],language_files_path:process._joystick_translations?.normal?.path||`${z}i18n`,render_component_path:l,req:o}),y=$(o),g=await w({api_schema:e?.options?.api,attributes:t?.attributes,base_html:d,component_options:{props:p,translations:f,url:y},component_to_render:h||r,escaping:t?.escaping,head:t?.head,render_component_path:m,render_layout_path:c,req:o,res:s,mod:t?.mod===!1?null:{in_use:!!e?.mod,css:e?.mod?.css||null,js:e?.mod?.js||null,theme:o?.cookies?.theme||e?.options?.mod?.default_theme||"light",components_in_use:t?.mod?.components}});return s.status(200).send(g)},_()};var G=A;export{G as default};
