import u from"fs";import"../../../lib/dynamic_import.js";import _ from"../generate_joystick_error_page.js";import w from"../../../lib/get_joystick_build_path.js";import $ from"../../../lib/get_translations.js";import x from"./get_url.js";import v from"../../../lib/path_exists.js";import z from"../../ssr/index.js";import d from"../../../lib/strip_preceeding_slash.js";const{readFile:A}=u.promises,E=w(),c=`${E}i18n`,N=await v(c)&&u.readdirSync(c)||[],h=()=>A("index.html","utf-8"),C=await h(),D=(o,e,f,s={})=>{e.render=async(r="",t={})=>{const l=d(r),m=d(t?.layout),n=l,a=t?.layout?m:null;if(!process._joystick_components[n])return e.status(404).send(_({type:"page_not_found",path:`res.render('${n}')`,frame:null,stack:`A page component at the path ${n} could not be found.`}));if(a&&!process._joystick_components[a])return e.status(404).send(_({type:"layout_not_found",path:`res.render('${n}', { layout: '${m}' })`,frame:null,stack:`A layout component at the path ${t?.layout} could not be found.`}));const i=process._joystick_components[n],y=a?process._joystick_components[a]:null,p={...t?.props||{},theme:o?.cookies?.theme||"light"};a&&(p.page=i);const g=process.env.NODE_ENV!=="development"?C:await h(),k=await $({language_files:N,language_files_path:c,render_component_path:r,req:o}),b=x(o),j=await z({api_schema:s?.options?.api,attributes:t?.attributes,base_html:g,component_options:{props:p,translations:k,url:b},component_to_render:y||i,head:t?.head,render_component_path:l,render_layout_path:m,req:o,res:e,mod:t?.mod===!1?null:{in_use:!!s?.mod,css:s?.mod?.css||null,js:s?.mod?.js||null,theme:o?.cookies?.theme||s?.options?.mod?.default_theme||"light",components_in_use:t?.mod?.components}});return e.status(200).send(j)},f()};var K=D;export{K as default};
