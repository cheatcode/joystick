import k from"fs";import"../../../lib/dynamic_import.js";import p from"../generate_joystick_error_page.js";import j from"../../../lib/get_joystick_build_path.js";import b from"../../../lib/get_translations.js";import $ from"./get_url.js";import"../../../lib/path_exists.js";import w from"../../ssr/index.js";import _ from"../../../lib/strip_preceeding_slash.js";const{readFile:J}=k.promises,x=j(),z=(o,s,u,e={})=>{s.render=async(r="",t={})=>{const c=_(r),m=_(t?.layout),n=c,a=t?.layout?m:null;if(!process._joystick_components[n])return s.status(404).send(p({type:"page_not_found",path:`res.render('${n}')`,frame:null,stack:`A page component at the path ${n} could not be found.`}));if(a&&!process._joystick_components[a])return s.status(404).send(p({type:"layout_not_found",path:`res.render('${n}', { layout: '${m}' })`,frame:null,stack:`A layout component at the path ${t?.layout} could not be found.`}));const l=process._joystick_components[n],d=a?process._joystick_components[a]:null,i={...t?.props||{},theme:o?.cookies?.theme||"light"};a&&(i.page=l);const h=process._joystick_html,f=await b({language_files:process._joystick_translations?.normal?.files||[],language_files_path:process._joystick_translations?.normal?.path||`${x}i18n`,render_component_path:r,req:o}),y=$(o),g=await w({api_schema:e?.options?.api,attributes:t?.attributes,base_html:h,component_options:{props:i,translations:f,url:y},component_to_render:d||l,head:t?.head,render_component_path:c,render_layout_path:m,req:o,res:s,mod:t?.mod===!1?null:{in_use:!!e?.mod,css:e?.mod?.css||null,js:e?.mod?.js||null,theme:o?.cookies?.theme||e?.options?.mod?.default_theme||"light",components_in_use:t?.mod?.components}});return s.status(200).send(g)},u()};var K=z;export{K as default};
