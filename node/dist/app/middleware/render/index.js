import _ from"fs";import"../../../lib/dynamic_import.js";import d from"../generate_joystick_error_page.js";import w from"../../../lib/get_joystick_build_path.js";import x from"../../../lib/get_translations.js";import v from"./get_url.js";import z from"../../../lib/path_exists.js";import A from"../../ssr/index.js";import h from"../../../lib/strip_preceeding_slash.js";const{readFile:E}=_.promises,c=w(),r=`${c}i18n`,N=await z(r)&&_.readdirSync(r)||[],f=()=>E("index.html","utf-8"),C=await f(),D=(o,e,y,s={})=>{e.render=async(l="",t={})=>{const i=h(l),m=h(t?.layout),n=`${c}${i}`,a=t?.layout?`${c}${m}`:null;if(!process._joystick_components[n])return e.status(404).send(d({type:"page_not_found",path:`res.render('${n}')`,frame:null,stack:`A page component at the path ${n} could not be found.`}));if(a&&!process._joystick_components[a])return e.status(404).send(d({type:"layout_not_found",path:`res.render('${n}', { layout: '${m}' })`,frame:null,stack:`A layout component at the path ${t?.layout} could not be found.`}));const p=process._joystick_components[n],g=a?process._joystick_components[a]:null,u={...t?.props||{},theme:o?.cookies?.theme||"light"};a&&(u.page=p);const k=process.env.NODE_ENV!=="development"?C:await f(),$=await x({language_files:N,language_files_path:r,render_component_path:l,req:o}),b=v(o),j=await A({api_schema:s?.options?.api,attributes:t?.attributes,base_html:k,component_options:{props:u,translations:$,url:b},component_to_render:g||p,head:t?.head,render_component_path:i,render_layout_path:m,req:o,res:e,mod:t?.mod===!1?null:{in_use:!!s?.mod,css:s?.mod?.css||null,js:s?.mod?.js||null,theme:o?.cookies?.theme||s?.options?.mod?.default_theme||"light",components_in_use:t?.mod?.components}});return e.status(200).send(j)},y()};var K=D;export{K as default};
