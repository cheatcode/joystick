import t from"winston";import s from"fs";import e from"../lib/path_exists.js";import a from"../lib/push_encrypt.js";const{mkdir:n}=s.promises,i=async()=>{await e("/root/push/logs")||await n("/root/push/logs",{recursive:!0});const r=t.createLogger({format:t.format.combine(t.format.timestamp(),t.format(async o=>(o.message=a(o.message,process.env.PUSH_INSTANCE_TOKEN),o)),t.format.json()),transports:[new t.transports.File({filename:"/root/push/logs/app.log",maxsize:1024*1024*5,maxFiles:1,tailable:!0})]});process.stdout.write=o=>{r.info(o)},process.stderr.write=o=>{r.error(o)},process.on("uncaughtException",o=>{r.error(o instanceof Error?o?.toString():o)}),process.on("unhandledRejection",o=>{r.error(o instanceof Error?o?.toString():o)})};var g=i;export{g as default};
