import s from"winston";import r from"fs";import e from"../lib/path_exists.js";import n from"../lib/push_encrypt.js";const{mkdir:a}=r.promises,i=s.format(t=>({...t,message:n(t.message,process.env.PUSH_INSTANCE_TOKEN),doodle:"test"})),p=async()=>{await e("/root/push/logs")||await a("/root/push/logs",{recursive:!0});const t=s.createLogger({format:s.format.combine(s.format.timestamp(),i(),s.format.json()),transports:[new s.transports.File({filename:"/root/push/logs/app.log",maxsize:1024*1024*5,maxFiles:1,tailable:!0})]});process.stdout.write=o=>{t.info(o)},process.stderr.write=o=>{t.error(o)},process.on("uncaughtException",o=>{t.error(o instanceof Error?o?.toString():o)}),process.on("unhandledRejection",o=>{t.error(o instanceof Error?o?.toString():o)})};var l=p;export{l as default};
