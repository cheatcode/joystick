import t from"winston";import r from"fs";import e from"../lib/path_exists.js";import a from"../lib/push_encrypt.js";const{mkdir:n}=r.promises,i=t.format(o=>(o.message&&(o.message=a(o.message,process.env.PUSH_INSTANCE_TOKEN)),o)),m=async()=>{await e("/root/push/logs")||await n("/root/push/logs",{recursive:!0});const o=t.createLogger({format:t.format.combine(t.format.timestamp(),i(),t.format.json()),transports:[new t.transports.File({filename:"/root/push/logs/app.log",maxsize:1024*1024*5,maxFiles:1,tailable:!0})]});process.stdout.write=s=>{o.info(s)},process.stderr.write=s=>{o.error(s)},process.on("uncaughtException",s=>{o.error(s instanceof Error?s?.toString():s)}),process.on("unhandledRejection",s=>{o.error(s instanceof Error?s?.toString():s)})};var u=m;export{u as default};
