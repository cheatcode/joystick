import h from"https";import{URL as _}from"url";import l from"../../app/settings/load.js";const g=async a=>{const n=new _(`${a}/ping`);return new Promise(r=>{const t=h.request({method:"GET",hostname:n.hostname,port:n.port||443,path:n.pathname,timeout:3e3},e=>{r(e.statusCode>=200&&e.statusCode<400)});t.on("error",e=>{console.log("[ping_push] error",e),r(!1)}),t.on("timeout",()=>{t.destroy(),r(!1)}),t.end()})},f=async(a="",n="")=>{const t=l()?.private?.cheatcode?.push_debug_url||"https://push.cheatcode.co",e=`${t}/api/instances/${a}`,i=new _(e),u=await g(t);if(console.log("send_instance_data_to_push",{push_available:u}),!u)return;const c=JSON.stringify({type:a,data:n});return new Promise(p=>{const s=h.request({method:"POST",hostname:i.hostname,port:i.port||443,path:i.pathname,headers:{"x-push-instance-token":process.env.PUSH_INSTANCE_TOKEN,"Content-Type":"application/json","Content-Length":Buffer.byteLength(c)},timeout:5e3},o=>{let d="";o.on("data",m=>{d+=m}),o.on("end",()=>{o.statusCode>=200&&o.statusCode<400?p(d):p()})});s.on("error",o=>{console.log("send_instance_data_to_push POST error",o),p()}),s.on("timeout",()=>{s.destroy(),p()}),s.write(c),s.end()})};var T=f;export{T as default};
