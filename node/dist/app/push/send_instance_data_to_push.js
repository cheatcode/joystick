import d from"https";import{URL as _}from"url";import u from"../../app/settings/load.js";const m=async(s="",h="")=>{const c=`${u()?.private?.cheatcode?.push_debug_url||"https://push.cheatcode.co"}/api/instances/${s}`,e=new _(c),a=await new Promise(o=>{const n=d.request({method:"HEAD",hostname:e.hostname,port:e.port||443,path:e.pathname,headers:{}},t=>{o(t.statusCode>=200&&t.statusCode<400)});n.on("error",t=>{console.log("send_instance_data_to_push",error),o(!1)}),n.end()});if(console.log("send_instance_data_to_push",{head_ok:a}),!a)return;const r=JSON.stringify({type:s,data:h});return new Promise(o=>{const n=d.request({method:"POST",hostname:e.hostname,port:e.port||443,path:e.pathname,headers:{"x-push-instance-token":process.env.PUSH_INSTANCE_TOKEN,"Content-Type":"application/json","Content-Length":Buffer.byteLength(r)}},t=>{let p="";t.on("data",i=>{p+=i}),t.on("end",()=>{t.statusCode>=200&&t.statusCode<400?o(p):o()})});n.on("error",t=>{o()}),n.write(r),n.end()})};var w=m;export{w as default};
