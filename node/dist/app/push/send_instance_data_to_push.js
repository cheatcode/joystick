import d from"https";import{URL as _}from"url";import m from"../../app/settings/load.js";const l=async(n="",p="")=>{const a=`${m()?.private?.cheatcode?.push_debug_url||"https://push.cheatcode.co"}/api/instances/${n}`,e=new _(a),c={method:"HEAD",hostname:e.hostname,port:e.port||443,path:e.pathname,headers:{}};if(!await new Promise(s=>{const o=d.request(c,t=>{console.log("HEAD response received:",{url:a,status:t.statusCode,ok:t.statusCode>=200&&t.statusCode<400,statusText:t.statusMessage}),s(t.statusCode>=200&&t.statusCode<400)});o.on("error",t=>{console.error("HEAD request error:",t),s(!1)}),o.end()}))return;const r=JSON.stringify({type:n,data:p}),h={method:"POST",hostname:e.hostname,port:e.port||443,path:e.pathname,headers:{"x-push-instance-token":process.env.PUSH_INSTANCE_TOKEN,"Content-Type":"application/json","Content-Length":Buffer.byteLength(r)}};return new Promise(s=>{const o=d.request(h,t=>{let u="";t.on("data",i=>{u+=i}),t.on("end",()=>{console.log("POST response received:",{status:t.statusCode,ok:t.statusCode>=200&&t.statusCode<400,statusText:t.statusMessage}),t.statusCode>=200&&t.statusCode<400?s(u):s()})});o.on("error",t=>{console.error("POST request error:",t),s()}),o.write(r),o.end()})};var S=l;export{S as default};
