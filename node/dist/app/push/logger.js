import t from"winston";import s from"fs";import e from"../../lib/path_exists.js";import a from"../../lib/generate_id.js";import n from"../../lib/push_encrypt.js";const{mkdir:i}=s.promises,m=t.format(r=>({...r,message:n(r.message,process.env.PUSH_INSTANCE_TOKEN)})),p=async()=>{await e("/root/push/logs")||await i("/root/push/logs",{recursive:!0});const r=t.createLogger({format:t.format.combine(t.format.timestamp(),m(),t.format(o=>(o._id=a(16),o))(),t.format.json()),transports:[new t.transports.File({filename:"/root/push/logs/app.log",maxsize:1024*1024*10,maxFiles:1,tailable:!0})]});process.stdout.write=o=>{r.info(o)},process.stderr.write=o=>{r.error(o)},process.on("uncaughtException",o=>{r.error(o instanceof Error?o?.toString():o)}),process.on("unhandledRejection",o=>{r.error(o instanceof Error?o?.toString():o)})};var d=p;export{d as default};
