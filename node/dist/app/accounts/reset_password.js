import o from"../databases/queries/accounts.js";import _ from"./generate_account_session.js";import a from"../api/get_output.js";import i from"../../lib/hash_string.js";import n from"../../lib/types.js";const u=(s=null,e=null)=>o("remove_reset_token",{user_id:s,token:e}),c=(s=null,e=null)=>o("add_session",{user_id:s,session:e}),p=async(s="",e="")=>{const t=i(e);return await o("set_new_password",{user_id:s,hashed_password:t}),t},d=(s="")=>o("reset_user_sessions",{user_id:s}),w=(s="")=>o("user_with_reset_token",{"passwordResetTokens.token":s}),k=async(s={})=>{const e=await w(s.token);if(!e)throw new Error("Invalid password reset token.");await d(e?._id||e?.user_id),await p(e?._id||e?.user_id,s.password);const t=await u(e?._id||e?.user_id,s.token),r=_();return await c(t?._id||t?.user_id,r),(n.is_function(process.joystick?.app_options?.accounts?.events?.onResetPassword)||n.is_function(process.joystick?.app_options?.accounts?.events?.on_reset_password))&&(process.joystick?.app_options?.accounts?.events?.onResetPassword||process.joystick?.app_options?.accounts?.events?.on_reset_password)({user:t,...r}),{user:a(t,s?.output),...r}};var v=k;export{v as default};
