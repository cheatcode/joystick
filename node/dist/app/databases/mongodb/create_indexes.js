import c from"../../../lib/types.js";const r={sessions:async()=>{try{const e=process.databases._sessions?.collection("sessions");if(e){const t=await e.listIndexes().toArray();t.some(s=>s.key._id===1)||await e.createIndex({_id:1}),t.some(s=>s.key.createdAt===1&&s.expireAfterSeconds===3600)||await e.createIndex({createdAt:1},{expireAfterSeconds:3600})}}catch(e){console.warn(e)}},users:async()=>{try{const e=process.databases._users?.collection("users"),t=process.databases._users?.collection("roles");if(e){const s=await e.listIndexes().toArray(),i=[{_id:1},{emailAddress:1},{username:1},{"sessions.token":1},{"passwordResetTokens.token":1},{"passwordResetTokens.token":1,_id:1},{roles:1},{roles:1,_id:1}];for(const o of i)s.some(n=>JSON.stringify(n.key)===JSON.stringify(o))||await e.createIndex(o)}if(t){const s=await t.listIndexes().toArray(),i=[{role:1},{role:1,userId:1}];for(const o of i)s.some(n=>JSON.stringify(n.key)===JSON.stringify(o))||await t.createIndex(o)}}catch(e){console.warn(e)}}},a=async(e=[])=>{for(let t=0;t<e?.length;t+=1){const s=e[t];c.is_function(r[s])&&await r[s]()}};var l=a;export{l as default};
