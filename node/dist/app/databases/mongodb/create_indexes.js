import c from"../../../lib/types.js";const d={sessions:async()=>{await process.databases._sessions?.collection("sessions").createIndex("sessions",{_id:1}),await process.databases._sessions?.collection("sessions").createIndex("sessions",{createdAt:1},{expireAfterSeconds:3600})},users:async()=>{await process.databases._users?.collection("users").createIndex({_id:1}),await process.databases._users?.collection("users").createIndex({emailAddress:1}),await process.databases._users?.collection("users").createIndex({username:1}),await process.databases._users?.collection("users").createIndex({"sessions.token":1}),await process.databases._users?.collection("users").createIndex({"passwordResetTokens.token":1}),await process.databases._users?.collection("users").createIndex({"passwordResetTokens.token":1,_id:1}),await process.databases._users?.collection("users").createIndex({roles:1}),await process.databases._users?.collection("users").createIndex({roles:1,_id:1}),await process.databases._users?.collection("roles").createIndex({role:1}),await process.databases._users?.collection("roles").createIndex({role:1,userId:1})}},l=async(s=[])=>{for(let e=0;e<s?.length;e+=1){const o=s[e];if(c.is_function(d[o]))try{await p(o)}catch(t){console.error(`Error creating indexes for ${o}:`,t)}}};async function p(s){const e=process.databases[`_${s}`];if(!e)return;const o=await e.listCollections().toArray();for(const t of o){const a=await e.collection(t.name).indexes(),i=_(s,t.name);for(const n of i)a.some(r=>JSON.stringify(r.key)===JSON.stringify(n.key))||await e.collection(t.name).createIndex(n.key,n.options)}}function _(s,e){return{sessions:[{key:{_id:1},options:{}},{key:{createdAt:1},options:{expireAfterSeconds:3600}}],users:[{key:{_id:1},options:{}},{key:{emailAddress:1},options:{}},{key:{username:1},options:{}},{key:{"sessions.token":1},options:{}},{key:{"passwordResetTokens.token":1},options:{}},{key:{"passwordResetTokens.token":1,_id:1},options:{}},{key:{roles:1},options:{}},{key:{roles:1,_id:1},options:{}}],roles:[{key:{role:1},options:{}},{key:{role:1,userId:1},options:{}}]}[e]||[]}var k=l;export{k as default};
