import t from"node-cron";import i from"../../../lib/types.js";import n from"./handle_cleanup_sessions.js";const u=async(r="",e="",_="",a=[])=>process.databases[r]?.query(`CREATE UNIQUE INDEX IF NOT EXISTS ${e} ON ${_}(${a.join(", ")})`),s=async(r="",e="",_="",a=[])=>process.databases[r]?.query(`CREATE INDEX IF NOT EXISTS ${e} ON ${_}(${a.join(", ")})`),o={sessions:async()=>{await s("_sessions","session_by_id","sessions",["session_id"]),await s("_sessions","session_created_at","sessions",["created_at"]),t.schedule("*/30 * * * * *",()=>{n()})},users:async()=>{await s("_users","user_by_email","users",["email_address"]),await s("_users","user_by_username","users",["username"]),await s("_users","user_by_user_id","users",["user_id"]),await s("user_session_by_token","users_sessions",["token"]),await s("_users","user_password_reset_token_by_token","users_password_reset_tokens",["token"]),await s("_users","user_password_reset_token_by_user_id_token","users_password_reset_tokens",["user_id","token"]),await s("_users","user_role","users_roles",["role"]),await s("_users","user_roles_by_user_id_role","users_roles",["user_id","role"]),await s("_users","role","roles",["role"]),await u("_users","user_roles","users_roles",["user_id","role"])}},d=async(r=[])=>{for(let e=0;e<r?.length;e+=1){const _=r[e];i.is_function(o[_])&&await o[_]()}};var y=d;export{y as default};
