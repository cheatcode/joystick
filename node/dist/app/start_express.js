import c from"express";import"https";import l from"./middleware/built_in.js";import u from"../lib/get_joystick_build_path.js";import p from"../lib/types.js";const _=(s=null,o={})=>{const n=joystick?.settings?.config||{},d=u(),t=process.env.PORT?parseInt(process.env.PORT,10):2600;process.env.PORT=t;const e=c();typeof o?.options?.express?.on_after_create_app=="function"&&o.options.express.on_after_create_app(e);const f=e.listen(t,"0.0.0.0");if(l({app_instance:o,csp_config:o?.options?.csp,express_app:e,joystick_build_path:d,middleware_config:n?.middleware,port:t}),o?.options?.middleware&&p.is_array(o?.options?.middleware))for(let r=0;r<o?.options?.middleware?.length;r+=1){const m=o?.options?.middleware[r];e.use(m)}const i={port:t,app:e,server:f};return p.is_function(s)&&s(i,o),i};var b=_;export{b as default};
