import o from"node-html-parser";import m from"../../lib/types.js";const S=(y="",t=null,u={})=>{const p=o.parse(y),a=p.querySelector("head");if(u?.context?.session){const s=o.parse("<meta />").querySelector("meta");s.setAttribute("name","csrf"),s.setAttribute("content",u?.context?.session?.csrf),a.appendChild(s)}if(!t)return p.toString();if(t.title){const e=a.querySelector("title");if(e){const s=o.parse(`<title>${t.title}</title>`);a.exchangeChild(e,s)}e||a.insertAdjacentHTML("afterbegin",`<title>${t.title}</title>`)}if(t.tags&&t.tags.meta&&m.is_array(t.tags.meta)&&t.tags.meta.length>0)for(let e=0;e<t?.tags?.meta?.length;e+=1){const s=t.tags.meta[e],i=a.querySelector(`meta[name="${s.name}"]`),r=o.parse("<meta />"),n=Object.entries(s||{});for(let l=0;l<n?.length;l+=1){const[c,g]=n[l];r.querySelector("meta").setAttribute(c,g)}i&&a.exchangeChild(i,r),i||a.appendChild(r)}if(t.tags&&t.tags.link&&m.is_array(t.tags.link)&&t.tags.link.length>0)for(let e=0;e<t?.tags?.link?.length;e+=1){const s=t?.tags?.link[e],i=o.parse("<link />"),r=Object.entries(s||{});for(let n=0;n<r?.length;n+=1){const[l,c]=r[n];i.querySelector("link").setAttribute(l,c)}a.appendChild(i)}if(t.tags&&t.tags.script&&Array.isArray(t.tags.script)&&t.tags.script.length>0)for(let e=0;e<t?.tags?.script?.length;e+=1){const s=t.tags.script[e],i=o.parse("<script></script>"),r=Object.entries(s||{});for(let n=0;n<r?.length;n+=1){const[l,c]=r[n];i.querySelector("script").setAttribute(l,c)}a.appendChild(i)}if(t.tags&&t.tags.style&&Array.isArray(t.tags.style)&&t.tags.style.length>0)for(let e=0;e<t?.tags?.style?.length;e+=1){const s=t.tags.style[e],i=o.parse("<style></style>"),r=Object.entries(s||{});for(let n=0;n<r?.length;n+=1){const{attributes:l={},content:c=""}=r[n],g=Object.entries(l),f=i.querySelector("style");for(let _=0;_<g?.length;_+=1){const[b,A]=g[_];f.setAttribute(b,A)}c&&(f.innerHTML=c)}a.appendChild(i)}if(t.jsonld){const e=o.parse("<script></script>"),s=e.querySelector("script");s.setAttribute("type","application/ld+json"),s.set_content(JSON.stringify(t.jsonld,null,2)),a.appendChild(e)}return p.toString()};var q=S;export{q as default};
