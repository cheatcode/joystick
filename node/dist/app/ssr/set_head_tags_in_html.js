import g from"node-html-parser";import u from"../../lib/types.js";const y=(f="",t=null,_={})=>{const o=g.parse(f),a=o.querySelector("head");if(_?.context?.session){const s=g.parse("<meta />").querySelector("meta");s.setAttribute("name","csrf"),s.setAttribute("content",_?.context?.session?.csrf),a.appendChild(s)}if(!t)return o.toString();if(t.title){const e=a.querySelector("title");if(e){const s=g.parse(`<title>${t.title}</title>`);a.exchangeChild(e,s)}e||a.insertAdjacentHTML("afterbegin",`<title>${t.title}</title>`)}if(t.tags&&t.tags.meta&&u.is_array(t.tags.meta)&&t.tags.meta.length>0)for(let e=0;e<t?.tags?.meta?.length;e+=1){const s=t.tags.meta[e],n=a.querySelector(`meta[name="${s.name}"]`),r=g.parse("<meta />"),i=Object.entries(s||{});for(let l=0;l<i?.length;l+=1){const[c,p]=i[l];r.querySelector("meta").setAttribute(c,p)}n&&a.exchangeChild(n,r),n||a.appendChild(r)}if(t.tags&&t.tags.link&&u.is_array(t.tags.link)&&t.tags.link.length>0)for(let e=0;e<t?.tags?.link?.length;e+=1){const s=t?.tags?.link[e],n=g.parse("<link />"),r=Object.entries(s||{});for(let i=0;i<r?.length;i+=1){const[l,c]=r[i];n.querySelector("link").setAttribute(l,c)}a.appendChild(n)}if(t.tags&&t.tags.script&&Array.isArray(t.tags.script)&&t.tags.script.length>0)for(let e=0;e<t?.tags?.script?.length;e+=1){const s=t.tags.script[e],n=g.parse("<script></script>"),r=Object.entries(s||{});for(let i=0;i<r?.length;i+=1){const[l,c]=r[i];n.querySelector("script").setAttribute(l,c)}a.appendChild(n)}if(t.tags&&t.tags.style&&Array.isArray(t.tags.style)&&t.tags.style.length>0)for(let e=0;e<t?.tags?.style?.length;e+=1){const{attributes:s={},content:n=""}=t.tags.style[e],r=g.parse("<style></style>"),i=Object.entries(s),l=r.querySelector("style");for(let c=0;c<i?.length;c+=1){const[p,m]=i[c];l.setAttribute(p,m)}n&&(l.innerHTML=n),a.appendChild(r)}if(t.jsonld){const e=g.parse("<script></script>"),s=e.querySelector("script");s.setAttribute("type","application/ld+json"),s.set_content(JSON.stringify(t.jsonld,null,2)),a.appendChild(e)}return o.toString()};var S=y;export{S as default};
