import c from"node-html-parser";import _ from"../../lib/types.js";const f=(u="",t=null,p={})=>{const g=c.parse(u),i=g.querySelector("head");if(p?.context?.session){const s=c.parse("<meta />").querySelector("meta");s.setAttribute("name","csrf"),s.setAttribute("content",p?.context?.session?.csrf),i.appendChild(s)}if(!t)return g.toString();if(t.title){const e=i.querySelector("title");if(e){const s=c.parse(`<title>${t.title}</title>`);i.exchangeChild(e,s)}e||i.insertAdjacentHTML("afterbegin",`<title>${t.title}</title>`)}if(t.tags&&t.tags.meta&&_.is_array(t.tags.meta)&&t.tags.meta.length>0)for(let e=0;e<t?.tags?.meta?.length;e+=1){const s=t.tags.meta[e],r=i.querySelector(`meta[name="${s.name}"]`),a=c.parse("<meta />"),n=Object.entries(s||{});for(let l=0;l<n?.length;l+=1){const[o,m]=n[l];a.querySelector("meta").setAttribute(o,m)}r&&i.exchangeChild(r,a),r||i.appendChild(a)}if(t.tags&&t.tags.link&&_.is_array(t.tags.link)&&t.tags.link.length>0)for(let e=0;e<t?.tags?.link?.length;e+=1){const s=t?.tags?.link[e],r=c.parse("<link />"),a=Object.entries(s||{});for(let n=0;n<a?.length;n+=1){const[l,o]=a[n];r.querySelector("link").setAttribute(l,o)}i.appendChild(r)}if(t.tags&&t.tags.script&&Array.isArray(t.tags.script)&&t.tags.script.length>0)for(let e=0;e<t?.tags?.script?.length;e+=1){const s=t.tags.script[e],r=c.parse("<script></script>"),a=Object.entries(s||{});for(let n=0;n<a?.length;n+=1){const[l,o]=a[n];r.querySelector("script").setAttribute(l,o)}i.appendChild(r)}if(t.jsonld){const e=c.parse("<script></script>"),s=e.querySelector("script");s.setAttribute("type","application/ld+json"),s.set_content(JSON.stringify(t.jsonld,null,2)),i.appendChild(e)}return g.toString()};var S=f;export{S as default};
