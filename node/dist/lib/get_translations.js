import"fs";import p from"./dynamic_import.js";import _ from"./get_platform_safe_path.js";import o from"../app/settings/load.js";import"./path_exists.js";import m from"./types.js";const f=o(),h=async(a="",l="",r="")=>{const n=process.env.NODE_ENV!=="development"?`${l}/${a}`:`${l}/${a}?v=${new Date().getTime()}`,s=await p(_(n));if(s&&m.is_object(s)){const t=s[r];return t||s}return{}},d=(a="",l=[],r="")=>{let n=[];a&&n.push(a);const s=l?.filter(e=>!e?.includes("*"));return n.push(...s),(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language)&&n.push(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language),n?.flatMap(e=>{const t=[e];return e?.length===2&&t.push(`${e.substring(0,2)}-`),e?.length>2&&(t.push(`${e?.split("-")[0]}`),t.push(`${e?.split("-")[0]}-`)),t})?.map(e=>e[e.length-1]==="-"?new RegExp(r?`^${r}_${e}[A-Z]+.js`:`^${e}[A-Z]+.js`,"g"):new RegExp(r?`^${r}_${e}.js`:`^${e}.js`,"g"))},$=(a="")=>a.split(",")?.map(r=>r.split(";")[0]),w=async(a={})=>{const l=a?.is_email?a?.email_language_files_path:a?.language_files_path,r=a?.is_email?a?.email_language_files:a?.language_files,n=a?.is_email?[]:$(a?.req?.headers["accept-language"]),s=d(a?.req?.context?.user?.language,n,a?.email_template_name);let e=null;for(let c=0;c<s.length;c+=1){const u=s[c],i=r.find(g=>!!g.match(u));if(i){e=i;break}}return(e?await h(e,l,a?.render_component_path):null)||{}};var D=w;export{D as default};
