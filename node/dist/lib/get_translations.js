import"fs";import p from"./dynamic_import.js";import m from"./get_platform_safe_path.js";import h from"../app/settings/load.js";import"./path_exists.js";import u from"./types.js";const f=h(),d=async(s="",t="",n="")=>{if(process._joystick_translations){const e=t.includes("/email")?"email":"normal",r=process._joystick_translations[e]?.cache?.[s];if(r&&u.is_object(r)){const i=r[n];return i||r}}const c=process.env.NODE_ENV!=="development"?`${t}/${s}`:`${t}/${s}?v=${new Date().getTime()}`,a=await p(m(c));if(a&&u.is_object(a)){const e=a[n];return e||a}return{}},$=(s="",t="",n=[],c="")=>{let a=[];s&&a.push(s),t&&a.push(t);const l=n?.filter(e=>!e?.includes("*"));return a.push(...l),(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language)&&a.push(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language),a?.flatMap(e=>{const r=[e];return e?.length===2&&r.push(`${e.substring(0,2)}-`),e?.length>2&&(r.push(`${e?.split("-")[0]}`),r.push(`${e?.split("-")[0]}-`)),r})?.map(e=>e[e.length-1]==="-"?new RegExp(c?`^${c}_${e}[A-Z]+.js`:`^${e}[A-Z]+.js`,"g"):new RegExp(c?`^${c}_${e}.js`:`^${e}.js`,"g"))},w=(s="")=>s.split(",")?.map(n=>n.split(";")[0]),j=async(s={})=>{const t=s?.is_email?s?.email_language_files_path:s?.language_files_path,n=s?.is_email?s?.email_language_files:s?.language_files,c=s?.is_email?[]:w(s?.req?.headers["accept-language"]),a=s?.req?.cookies?.language,l=$(s?.req?.context?.user?.language,a,c,s?.email_template_name);let e=null;for(let i=0;i<l.length;i+=1){const g=l[i],o=n.find(_=>!!_.match(g));if(o){e=o;break}}return(e?await d(e,t,s?.render_component_path):null)||{}};var D=j;export{D as default};
