import"fs";import _ from"./dynamic_import.js";import p from"./get_platform_safe_path.js";import m from"../app/settings/load.js";import"./path_exists.js";import u from"./types.js";const f=m(),h=async(e="",n="",a="")=>{if(process._joystick_translations){const r=n.includes("/email")?"email":"normal",i=process._joystick_translations[r]?.cache?.[e];if(i&&u.is_object(i)){const l=i[a];return l||i}}const c=process.env.NODE_ENV!=="development"?`${n}/${e}`:`${n}/${e}?v=${new Date().getTime()}`,t=await _(p(c));if(t&&u.is_object(t)){const r=t[a];return r||t}return{}},d=(e="",n=[],a="")=>{let c=[];e&&c.push(e);const t=n?.filter(s=>!s?.includes("*"));return c.push(...t),(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language)&&c.push(f?.config?.i18n?.defaultLanguage||f?.config?.i18n?.default_language),c?.flatMap(s=>{const r=[s];return s?.length===2&&r.push(`${s.substring(0,2)}-`),s?.length>2&&(r.push(`${s?.split("-")[0]}`),r.push(`${s?.split("-")[0]}-`)),r})?.map(s=>s[s.length-1]==="-"?new RegExp(a?`^${a}_${s}[A-Z]+.js`:`^${s}[A-Z]+.js`,"g"):new RegExp(a?`^${a}_${s}.js`:`^${s}.js`,"g"))},$=(e="")=>e.split(",")?.map(a=>a.split(";")[0]),w=async(e={})=>{const n=e?.is_email?e?.email_language_files_path:e?.language_files_path,a=e?.is_email?e?.email_language_files:e?.language_files,c=e?.is_email?[]:$(e?.req?.headers["accept-language"]),t=d(e?.req?.context?.user?.language,c,e?.email_template_name);let s=null;for(let i=0;i<t.length;i+=1){const l=t[i],o=a.find(g=>!!g.match(l));if(o){s=o;break}}return(s?await h(s,n,e?.render_component_path):null)||{}};var A=w;export{A as default};
