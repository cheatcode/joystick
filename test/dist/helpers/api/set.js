import l from"../../lib/generate_cookie_header.js";import i from"../../lib/log_request_errors.js";import f from"../../lib/parse_json.js";const u=async(r={})=>{const e=await r.text();return f(e)},_=(r={})=>{const e={...r};return e?.loader&&delete e.loader,JSON.stringify(e)},y=(r="",e={})=>typeof window.fetch<"u"?new Promise((n,t)=>{const c=`${window.location.origin}/api/_setters/${r}`,d=_(e),s={...e?.headers||{},"Content-Type":"application/json","x-joystick-csrf":"joystick_test"};return e?.user&&(s.Cookie=l({joystick_login_token:e?.user?.joystick_login_token,joystick_login_token_expires_at:e?.user?.joystick_login_token_expires_at})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${r}_loading`]:!0}),fetch(c,{method:"POST",mode:"cors",headers:s,body:d,credentials:"include",cache:"no-store"}).then(async o=>{const a=await u(o);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${r}_loading`]:!1}),a?.errors?(i("Set request",a.errors),t(a)):n(a)}).catch(o=>(i("Set request",[o]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${r}_loading`]:!1}),t({errors:[o]})))}):Promise.resolve();var m=y;export{m as default};
