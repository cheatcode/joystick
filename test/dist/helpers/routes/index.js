import{URL as i,URLSearchParams as u}from"url";import p from"node-fetch";import y from"../../lib/generateCookieHeader.js";const n=(e="",t="",r={})=>{const o=t?.toLocaleLowerCase(),c={method:o,mode:"cors",headers:{connect:{...r?.headers||{}},delete:{"Content-Type":"application/json",...r?.headers||{}},get:{...r?.headers||{}},head:{...r?.headers||{}},options:{...r?.headers||{}},patch:{"Content-Type":"application/json",...r?.headers||{}},post:{"Content-Type":"application/json",...r?.headers||{}},put:{"Content-Type":"application/json",...r?.headers||{}}}[o]||{...r?.headers||{}},cache:"no-store"};r?.user&&(c.headers.Cookie=y({joystickLoginToken:r?.user?.joystickLoginToken,joystickLoginTokenExpiresAt:r?.user?.joystickLoginTokenExpiresAt})),["delete","patch","post","put"].includes(o)&&r?.body&&(c.body=JSON.stringify(r?.body));const s=new i(`http://localhost:${process.env.PORT}${e}`);return r?.query&&(s.search=new u(r?.query||{})),p(s,c).then(async a=>{const d=a?.headers?.get("content-type"),h=Object.fromEntries(a.headers.entries());if(d?.includes("text/html"))return{headers:h,body:await a.text()};if(d?.includes("application/json"))return{headers:h,body:await a.json()}}).catch(a=>a)};var m={connect:(e="",t={})=>n(e,"CONNECT",t),delete:(e="",t={})=>n(e,"DELETE",t),get:(e="",t={})=>n(e,"GET",t),head:(e="",t={})=>n(e,"HEAD",t),options:(e="",t={})=>n(e,"OPTIONS",t),patch:(e="",t={})=>n(e,"PATCH",t),post:(e="",t={})=>n(e,"POST",t),put:(e="",t={})=>n(e,"PUT",t)};export{m as default};
