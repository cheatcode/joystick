import{URL as h,URLSearchParams as u}from"url";import l from"node-fetch";import p from"../../lib/generate_cookie_header.js";import _ from"../../lib/get_test_port.js";const o=(t="",r="",e={})=>{const a=r?.toLocaleLowerCase(),c={method:a,mode:"cors",headers:{get:{...e?.headers||{}},delete:{"Content-Type":"application/json",...e?.headers||{}},patch:{"Content-Type":"application/json",...e?.headers||{}},post:{"Content-Type":"application/json",...e?.headers||{}},put:{"Content-Type":"application/json",...e?.headers||{}}}[a]||{...e?.headers||{}},cache:"no-store"};e?.user&&(c.headers.Cookie=p({joystick_login_token:e?.user?.joystick_login_token,joystick_login_token_expires_at:e?.user?.joystick_login_token_expires_at})),["delete","patch","post","put"].includes(a)&&e?.body&&(c.body=JSON.stringify(e?.body));const s=new h(`http://localhost:${_()}${t}`);return e?.query&&(s.search=new u(e?.query||{})),l(s,c).then(async n=>{const i=n?.headers?.get("content-type"),d=Object.fromEntries(n.headers.entries());return i?.includes("text/html")?{headers:d,body:await n.text()}:i?.includes("application/json")?{headers:d,body:await n.json()}:null}).catch(n=>n)},y={get:(t="",r={})=>o(t,"GET",r),delete:(t="",r={})=>o(t,"DELETE",r),patch:(t="",r={})=>o(t,"PATCH",r),post:(t="",r={})=>o(t,"POST",r),put:(t="",r={})=>o(t,"PUT",r)};var k=y;export{k as default};
