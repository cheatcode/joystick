import n from"../../lib/loadSettings.js";import p from"./mongodb/index.js";import i from"./postgresql/index.js";var l=async()=>{const r=(await n({environment:"test"}))?.parsed?.config?.databases?.map(e=>({provider:e?.provider,settings:e}));for(let e=0;e<r?.length;e+=1){const t=r[e],a=r?.filter(s=>s?.provider===s?.provider)?.length>1,o=parseInt(process.env.PORT,10)+10+e;if(t?.provider==="mongodb"){const s=await p(t?.settings,o);process.databases={...process.databases||{},mongodb:a?{...process?.databases?.mongodb||{},[t?.settings?.name||`mongodb_${o}`]:s}:s}}if(t?.provider==="postgresql"){const s=await i(t?.settings,o);process.databases={...process.databases||{},postgresql:a?{...process?.databases?.postgresql||{},[t?.settings?.name||`postgresql_${o}`]:{...s?.pool,query:s?.query}}:{...s?.pool,query:s?.query}}}}return process.databases};export{l as default};
