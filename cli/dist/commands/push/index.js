import p from"../../lib/build/index.js";import n from"../../lib/cli_log.js";import c from"./get_deployment.js";import l from"./get_push_domain.js";import m from"./get_settings_file.js";import u from"./get_deployment_token.js";import y from"./upload_build_to_push.js";import h from"../../lib/loader.js";const _=async(r="")=>{const t=await u(r);return t||(n("Must pass a deployment token via the -t or --token flag, or, have an existing deployment token on your machine.",{level:"danger",docs:"https://cheatcode.co/docs/push/authentication"}),process.exit(0))},g=async(r={},t={})=>{if(!t?.domain)return n("Must pass a deployment via -d or --domain flag.",{level:"danger",docs:"https://cheatcode.co/docs/push/cli"}),process.exit(0);process.loader=new h,process.loader.print("Starting deployment...");const s=await _(t?.deployment_token),o=l(t?.push_server),e=await c({domain:t?.domain,deployment_token:s,push_domain:o});if(e?.status===403)return n(e?.error,{level:"danger",docs:"https://cheatcode.co/docs/push/deployments/create-a-new-deployment"}),process.exit(0);if(!e)return n(`Sorry, we couldn't find a deployment with the domain ${t?.domain} on your account. If you haven't created it yet, head over to the Push dashboard: https://push.cheatcode.co/deployments/create`,{level:"danger",docs:"https://cheatcode.co/docs/push/deployments/create-a-new-deployment"}),process.exit(0);const a=e?.environment||"production",d=new Date().toISOString(),i=await m({environment:a});await p({environment:a,encrypt_build:!0,encryption_key:e?.deployment_secret,silence_confirmation:!0}),process.loader.print("Deploying to Push..."),await y({build_timestamp:d,deployment:e,deployment_token:s,push_domain:o,settings:i}),process.loader.print("Deploying..."),console.log(e?.initial_deployment_completed?`
Monitor your deployment at ${o}/deployments/${e?._id}.
`:`
Finish your deployment's setup at ${o}/deployments/${e?._id}/setup.
`),process.exit(0)};var D=g;export{D as default};
//# sourceMappingURL=index.js.map
