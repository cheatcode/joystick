import c from"fs";import i from"chalk";import s from"child_process";import o from"util";import n from"./build_package_json.js";import l from"../../lib/cli_log.js";import m from"../../lib/loader.js";import u from"../../lib/node_path_polyfills.js";import t from"../../lib/replace_in_files.js";const{cp:p,writeFile:d,mkdir:a}=c.promises,y=o.promisify(s.exec),$=(e="")=>d(`./${e}/package.json`,n(e)),j=async(e={},r={})=>{process.loader=new m,process.loader.print("Creating app..."),r?.release&&!["production","canary"].includes(r.release)&&(l("Must pass either production or canary for --release.",{level:"danger",docs:"https://docs.cheatcode.co/joystick/cli/create"}),process.exit(0)),await p(`${u?.__package}/commands/create/template`,`./${e.name}`,{recursive:!0}),await $(e.name),await a(`./${e?.name}/.joystick`,{recursive:!0}),await a(`./${e?.name}/fixtures`,{recursive:!0}),await a(`./${e?.name}/indexes`,{recursive:!0}),await a(`./${e?.name}/lib`,{recursive:!0}),await a(`./${e?.name}/private`,{recursive:!0}),await a(`./${e?.name}/queues`,{recursive:!0}),await a(`./${e?.name}/routes`,{recursive:!0}),await a(`./${e?.name}/uploaders`,{recursive:!0}),await a(`./${e?.name}/tests`,{recursive:!0}),await a(`./${e?.name}/websockets`,{recursive:!0}),r?.release==="canary"&&(await t(`${process.cwd()}/${e?.name}`,{match:[/\.js$/],exclude:[/node_modules/],replace_regex:/(@joystick.js\/node)(?!-)/g,replace_with:"@joystick.js/node-canary"}),await t(`${process.cwd()}/${e?.name}`,{match:[/\.js$/],exclude:[/node_modules/],replace_regex:/(@joystick.js\/ui)(?!-)/g,replace_with:"@joystick.js/ui-canary"})),setTimeout(async()=>{process.loader.print("Installing dependencies..."),await y(`cd ./${e?.name} && npm install --save @joystick.js/ui${r?.release==="canary"?"-canary":""}@latest @joystick.js/node${r?.release==="canary"?"-canary":""}@latest @joystick.js/test${r?.release==="canary"?"-canary":""}@latest`),console.log(`${i.green("Project created! To get started, run:")}
cd ${e?.name} && joystick${r?.release==="canary"?"-canary":""} start`)},1e3)};var q=j;export{q as default};
//# sourceMappingURL=index.js.map
