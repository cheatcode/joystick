{
  "version": 3,
  "sources": ["../../../src/commands/push_v2/index.js"],
  "sourcesContent": ["import build from '../../lib/build/index.js';\nimport cli_log from '../../lib/cli_log.js';\nimport get_deployment from './get_deployment.js';\nimport get_push_domain from './get_push_domain.js';\nimport get_settings_file from './get_settings_file.js';\nimport get_deployment_token from './get_deployment_token.js';\nimport upload_build_to_push from './upload_build_to_push.js';\nimport Loader from '../../lib/loader.js';\n\nconst get_token_for_deployment = async (input_deployment_token = '') => {\n\tconst deployment_token = await get_deployment_token(input_deployment_token);\n\n\tif (!deployment_token) {\n    cli_log(\n      'Must pass a deployment token via the -t or --token flag, or, have an existing deployment token on your machine.',\n      {\n        level: \"danger\",\n        docs: \"https://cheatcode.co/docs/push/authentication\"\n      }\n    );\n\n    return process.exit(0);\n\t}\n\n\treturn deployment_token;\n};\n\nconst push = async (args = {}, options = {}) => {\n\tif (!options?.domain) {\n    cli_log(\n      `Must pass a deployment via -d or --domain flag.`,\n      {\n        level: \"danger\",\n        docs: \"https://cheatcode.co/docs/push/cli\"\n      }\n    );\n\n    return process.exit(0);\t\n\t}\n\n\tprocess.loader = new Loader();\n\tprocess.loader.print('Starting deployment...');\n\n\tconst deployment_token = await get_token_for_deployment(options?.deployment_token);\n\tconst environment = options?.environment || 'production';\n  const settings = await get_settings_file({ environment });\n  const push_domain = get_push_domain(options?.push_server);\n\n\tconst deployment = await get_deployment({\n\t\tdomain: options?.domain,\n\t\tdeployment_token,\n\t\tpush_domain,\n\t});\n\n\tif (!deployment) {\n    cli_log(\n      `Sorry, we couldn\\'t find a deployment with the domain ${options?.domain} on your account. If you haven\\'t created it yet, head over to the Push dashboard: https://push.cheatcode.co/deployments/create`,\n      {\n        level: \"danger\",\n        docs: \"https://cheatcode.co/docs/push/deployments/create-a-new-deployment\"\n      }\n    );\n\n    return process.exit(0);\t\t\n\t}\n\n\tconst build_timestamp = new Date().toISOString();\n\t\t\n\tawait build({\n\t\tenvironment,\n\t\tencrypt_build: true,\n\t\tencryption_key: deployment?.deployment_secret,\n\t\tsilence_confirmation: true,\n\t});\n\n\tprocess.loader.print('Deploying to Push...');\n\n\tawait upload_build_to_push({\n\t\tbuild_timestamp,\n\t\tdeployment,\n\t\tdeployment_token,\n\t\tpush_domain,\n\t\tsettings,\n\t});\n\n\tprocess.loader.print(deployment?.intial_deployment_completed ? `Deploying. Monitor your deployment at ${push_domain}/deployments/${deployment?._id}.` : `Deploying. Finish your deployment's setup at ${push_domain}/deployments/${deployment?._id}/setup.`);\n};\n\nexport default push;\n"],
  "mappings": "AAAA,OAAOA,MAAW,2BAClB,OAAOC,MAAa,uBACpB,OAAOC,MAAoB,sBAC3B,OAAOC,MAAqB,uBAC5B,OAAOC,MAAuB,yBAC9B,OAAOC,MAA0B,4BACjC,OAAOC,MAA0B,4BACjC,OAAOC,MAAY,sBAEnB,MAAMC,EAA2B,MAAOC,EAAyB,KAAO,CACvE,MAAMC,EAAmB,MAAML,EAAqBI,CAAsB,EAE1E,OAAKC,IACFT,EACE,kHACA,CACE,MAAO,SACP,KAAM,+CACR,CACF,EAEO,QAAQ,KAAK,CAAC,EAIzB,EAEMU,EAAO,MAAOC,EAAO,CAAC,EAAGC,EAAU,CAAC,IAAM,CAC/C,GAAI,CAACA,GAAS,OACX,OAAAZ,EACE,kDACA,CACE,MAAO,SACP,KAAM,oCACR,CACF,EAEO,QAAQ,KAAK,CAAC,EAGxB,QAAQ,OAAS,IAAIM,EACrB,QAAQ,OAAO,MAAM,wBAAwB,EAE7C,MAAMG,EAAmB,MAAMF,EAAyBK,GAAS,gBAAgB,EAC3EC,EAAcD,GAAS,aAAe,aACrCE,EAAW,MAAMX,EAAkB,CAAE,YAAAU,CAAY,CAAC,EAClDE,EAAcb,EAAgBU,GAAS,WAAW,EAEnDI,EAAa,MAAMf,EAAe,CACvC,OAAQW,GAAS,OACjB,iBAAAH,EACA,YAAAM,CACD,CAAC,EAED,GAAI,CAACC,EACF,OAAAhB,EACE,wDAAyDY,GAAS,MAAM,iIACxE,CACE,MAAO,SACP,KAAM,oEACR,CACF,EAEO,QAAQ,KAAK,CAAC,EAGxB,MAAMK,EAAkB,IAAI,KAAK,EAAE,YAAY,EAE/C,MAAMlB,EAAM,CACX,YAAAc,EACA,cAAe,GACf,eAAgBG,GAAY,kBAC5B,qBAAsB,EACvB,CAAC,EAED,QAAQ,OAAO,MAAM,sBAAsB,EAE3C,MAAMX,EAAqB,CAC1B,gBAAAY,EACA,WAAAD,EACA,iBAAAP,EACA,YAAAM,EACA,SAAAD,CACD,CAAC,EAED,QAAQ,OAAO,MAAME,GAAY,4BAA8B,yCAAyCD,CAAW,gBAAgBC,GAAY,GAAG,IAAM,gDAAgDD,CAAW,gBAAgBC,GAAY,GAAG,SAAS,CAC5P,EAEA,IAAOE,EAAQR",
  "names": ["build", "cli_log", "get_deployment", "get_push_domain", "get_settings_file", "get_deployment_token", "upload_build_to_push", "Loader", "get_token_for_deployment", "input_deployment_token", "deployment_token", "push", "args", "options", "environment", "settings", "push_domain", "deployment", "build_timestamp", "push_v2_default"]
}
