import{exec as m,execSync as f}from"child_process";import n from"path";import{fileURLToPath as k}from"url";import g from"fs";const _=k(import.meta.url),c=n.dirname(_),$=()=>{try{return f("docker --version",{stdio:"ignore"}),!0}catch{return!1}},D=(r="",s="",{apt_deps:l=[],npm_deps:d=[]}={})=>new Promise((a,i)=>{if(!$())return console.log(`
`),process.loader.print("Push requires Docker to deploy your app. Please visit https://docs.docker.com/get-started/get-docker/ to download Docker for your OS."),console.log(`
`),process.exit();process.loader.print("Building Docker image for deployment...");const e=n.join(c,"Dockerfile");if(!g.existsSync(e)){i(new Error(`Dockerfile not found at ${e}`));return}const u=`docker build ${[`CUSTOM_APT_DEPS=${l.join(" ")}`,`GLOBAL_NPM_PACKAGES=${d.join(" ")}`].map(o=>`--build-arg ${o}`).join(" ")} -t ${r} -f "${e}" "${s||c}"`;m(u,(o,p,t)=>{if(o){console.error(`Error building Docker image: ${o.message}`),i(o);return}t&&console.error(`Docker build stderr: ${t}`),process.loader.print(p),process.loader.print(`Successfully built Docker image: ${r}`),a()})});var x=D;export{x as default};
