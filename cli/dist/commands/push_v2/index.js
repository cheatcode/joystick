import p from"chalk";import d from"inquirer";import l from"../../lib/build/index.js";import i from"../../lib/cli_log.js";import a from"./prompts/confirm_deployment.js";import"./create_version.js";import"./get_deployment.js";import _ from"./get_push_domain.js";import u from"./get_settings_file.js";import f from"./get_session_token.js";import"./handle_initial_deployment.js";import"./handle_version_deployment.js";import g from"../../lib/loader.js";import"./upload_build_to_cdn.js";import"./validate_deployment.js";import"./validate_push_config.js";const P=(o="",t="",s={})=>{let e="";for(let n=0;n<s?.errors?.length;n+=1){const r=s?.errors[n];o==="push_config"&&(e+=`${p.yellowBright(`> ${r.field}`)}
`),e+=`${r?.error}
${n+1===s?.errors?.length?"":`
`}`}i(`${t?`${p.yellowBright(t)}


`:""}${e}`,{level:"danger",docs:{push_config:"https://cheatcode.co/docs/push/config",deployment:"https://cheatcode.co/docs/push/subscription"}[o]}),process.exit(0)},h=async()=>{const o=await f();return o||(i(data?.error?.message,{level:"danger",docs:"https://cheatcode.co/docs/push/cli#authentication"}),process.exit(0))},Q=(o="")=>(i(`settings.${o}.json must contain a push config object. Add this following the docs link below and try again.`,{level:"danger",docs:"https://cheatcode.co/docs/push/config"}),process.exit(0)),y=async(o={},t={})=>{process.loader=new g,process.loader.print("Starting deployment...");const s=await h(),e=t?.environment||"production",r=(await u({environment:e}))?.config?.push||{},w=_(t?.push_server),c={status:"undeployed",deployment_secret:"abc123"},{confirm_deployment:m}=await d.prompt(a([]));if(m){c?.status==="undeployed"&&console.log(`
`);const v=new Date().toISOString();await l({environment:e,encrypt_build:!0,encryption_key:c?.deployment_secret,silence_confirmation:!0}),console.log("Now do the docker build.")}};var R=y;export{R as default};
