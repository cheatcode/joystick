import l from"child_process";import p from"../cli_log.js";import f from"chalk";const g=(e="")=>{if(e?.includes("Using configuration"))return null;if(e?.includes("No tests found"))return p("No tests found. Add tests in the /tests folder at the root of your Joystick app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/test/setup"});console.log(e)},_=(e="")=>{if(e?.includes("Using configuration"))return null;if(e?.includes("No tests found in")){const[s]=e?.split(",");return console.log(`${s}
`)}console.log(e)},u=(e={},s={})=>{e.stdout.on("data",function(o){const n=o.toString();_(n,s)}),e.stderr.on("data",function(o){const n=o.toString();g(n,s)})},m=(e={})=>{const s=`${process.cwd()}/node_modules/.bin/ava`,o=`${e?.__dirname}/tap_reporter.js`;return new Promise((n,i)=>{console.log(f.cyan(`
\u{1F9EA} Running tests...
`));const c=`${s} --config ${e?.__dirname}/ava_config.js --tap | node ${o}`,a=l.exec(c,{env:{...process.env,databases:process.databases,FORCE_COLOR:"1"}},(t,r,d)=>{n()});a.stdout.on("data",t=>{process.stdout.write(t)}),a.stderr.on("data",t=>{t.toString().includes("Using configuration")||process.stderr.write(t)})})},h=(e={})=>{const s=`${process.cwd()}/node_modules/.bin/ava`,o=`${e?.__dirname}/tap_reporter.js`;return new Promise(n=>{const i=`DEBUG=ava:watcher && ${s} --config ${e?.__dirname}/ava_config.js`,c=e?.watch?"--watch":"",a=e?.watch?"":`--tap | node ${o}`,t=`${i} ${c} ${a}`,r=l.exec(t,{stdio:"inherit",env:{...process.env,databases:process.databases,FORCE_COLOR:"1"}},d=>{d?(e.cleanup_process.send(JSON.stringify({process_ids:e?.process_ids})),process.exit(0)):(e.cleanup_process.send(JSON.stringify({process_ids:e?.process_ids})),process.exit(0))});u(r,e)})};var O=h;export{O as default,m as run_tests_integrated};
//# sourceMappingURL=run_tests.js.map
