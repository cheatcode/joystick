import p from"child_process";import l from"../cli_log.js";import"chalk";const f=(e="")=>{if(e?.includes("Using configuration"))return null;if(e?.includes("No tests found"))return l("No tests found. Add tests in the /tests folder at the root of your Joystick app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/test/setup"});console.log(e)},g=(e="")=>{if(e?.includes("Using configuration"))return null;if(e?.includes("No tests found in")){const[s]=e?.split(",");return console.log(`${s}
`)}console.log(e)},_=(e={},s={})=>{e.stdout.on("data",function(o){const n=o.toString();g(n,s)}),e.stderr.on("data",function(o){const n=o.toString();f(n,s)})},u=(e={})=>{const s=`${process.cwd()}/node_modules/.bin/ava`,o=`${e?.__dirname}/tap_reporter.js`;return new Promise((n,i)=>{process.loader.print(`
Running tests...
`);const r=`${s} --config ${e?.__dirname}/ava_config.js --tap | node ${o}`,a=p.exec(r,{env:{...process.env,databases:process.databases,FORCE_COLOR:"1"}},(t,c,d)=>{n()});a.stdout.on("data",t=>{process.stdout.write(t)}),a.stderr.on("data",t=>{t.toString().includes("Using configuration")||process.stderr.write(t)})})},m=(e={})=>{const s=`${process.cwd()}/node_modules/.bin/ava`,o=`${e?.__dirname}/tap_reporter.js`;return new Promise(n=>{const i=`DEBUG=ava:watcher && ${s} --config ${e?.__dirname}/ava_config.js`,r=e?.watch?"--watch":"",a=e?.watch?"":`--tap | node ${o}`,t=`${i} ${r} ${a}`,c=p.exec(t,{stdio:"inherit",env:{...process.env,databases:process.databases,FORCE_COLOR:"1"}},d=>{d?(e.cleanup_process.send(JSON.stringify({process_ids:e?.process_ids})),process.exit(0)):(e.cleanup_process.send(JSON.stringify({process_ids:e?.process_ids})),process.exit(0))});_(c,e)})};var O=m;export{O as default,u as run_tests_integrated};
//# sourceMappingURL=run_tests.js.map
