import{promisify as o}from"util";import{execFile as g}from"child_process";import r from"fs";import m from"os";import e from"path";const a=o(g),d=o(r.mkdir),y=o(r.symlink),l=o(r.access),_=async()=>{try{const s="16",p=`/usr/lib/postgresql/${s}/bin`,i=e.join(m.homedir(),".joystick","databases","postgresql","bin"),n=e.join(i,"bin"),c=e.join(n,"postgres");try{await l(c,r.constants.X_OK);return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await a("sudo",["sh","-c",'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list']),await a("sudo",["apt-get","update"]),await a("sudo",["apt-get","install","-y",`postgresql-${s}`,`postgresql-client-${s}`,`postgresql-server-dev-${s}`]),await d(i,{recursive:!0});try{await y(p,n)}catch(t){if(t.code!=="EEXIST")throw console.error("Error creating symlink:",t),t}try{await l(c,r.constants.X_OK)}catch(t){throw console.error("Error accessing PostgreSQL executable:",t),t}process.loader.print("PostgreSQL installed!")}catch(s){throw console.error("Error installing PostgreSQL:",s),s}};var k=_;export{k as default};
