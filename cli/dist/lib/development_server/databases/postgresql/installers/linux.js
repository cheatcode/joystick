import{promisify as t}from"util";import{execFile as l}from"child_process";import i from"fs";import c from"os";import n from"path";const e=t(l),g=t(i.mkdir),p=t(i.symlink),m=async()=>{try{try{await e("which",["pg_ctl"]),console.log("PostgreSQL is already installed.");return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await e("sudo",["apt-get","update"]),await e("sudo",["apt-get","install","-y","postgresql-client-14","postgresql-server-dev-14"]),process.loader.print("PostgreSQL binaries installed!");const a="/usr/lib/postgresql/14/bin",s=n.join(c.homedir(),".joystick","databases","postgresql");await g(s,{recursive:!0});try{await p(a,n.join(s,"bin")),console.log(`Created symlink to PostgreSQL binaries in ${s}`)}catch(o){if(o.code==="EEXIST")console.log("Symlink already exists.");else throw console.error("Error creating symlink:",o),o}console.log("PostgreSQL binaries have been installed without creating or starting any clusters."),console.log("To create a cluster, you will need to run initdb manually.")}catch(r){throw console.error("Error installing PostgreSQL:",r),r}};var f=m;export{f as default};
