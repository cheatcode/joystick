import{promisify as r}from"util";import{execFile as c}from"child_process";import n from"fs";import g from"os";import a from"path";const s=r(c),p=r(n.mkdir),m=r(n.symlink),y=async()=>{try{try{await s("which",["pg_ctl"]),console.log("PostgreSQL is already installed.");return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await s("sudo",["apt-get","update"]),await s("sudo",["apt-get","install","-y","postgresql-client-14","postgresql-server-dev-14"]),process.loader.print("PostgreSQL binaries installed!");const l="/usr/lib/postgresql/14/bin",e=a.join(g.homedir(),".joystick","databases","postgresql","bin"),i=a.join(e,"bin");await p(e,{recursive:!0});try{await m(l,i),console.log(`Created symlink to PostgreSQL binaries at ${i}`)}catch(o){if(o.code==="EEXIST")console.log("Symlink already exists.");else throw console.error("Error creating symlink:",o),o}console.log("PostgreSQL binaries have been installed without creating or starting any clusters."),console.log("To create a cluster, you will need to run initdb manually.")}catch(t){throw console.error("Error installing PostgreSQL:",t),t}};var f=y;export{f as default};
