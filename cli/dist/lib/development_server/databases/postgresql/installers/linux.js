import{promisify as e}from"util";import{execFile as g}from"child_process";import r from"fs";import d from"os";import a from"path";const o=e(g),m=e(r.mkdir),y=e(r.symlink),l=e(r.access),u=async()=>{try{const s="16",p=`/usr/lib/postgresql/${s}/bin`,i=a.join(d.homedir(),".joystick","databases","postgresql","bin"),n=a.join(i,"bin"),c=a.join(n,"postgres");try{await l(c,r.constants.X_OK);return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await o("sudo",["apt-get","install","-y","wget"]),await o("sudo",["sh","-c",'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list']),await o("wget",["--quiet","-O","-","https://www.postgresql.org/media/keys/ACCC4CF8.asc","|","sudo","apt-key","add","-"]),await o("sudo",["apt-get","update"]),await o("sudo",["apt-get","install","-y",`postgresql-${s}`,`postgresql-client-${s}`,`postgresql-server-dev-${s}`]),await m(i,{recursive:!0});try{await y(p,n)}catch(t){if(t.code!=="EEXIST")throw console.error("Error creating symlink:",t),t}try{await l(c,r.constants.X_OK)}catch(t){throw console.error("Error accessing PostgreSQL executable:",t),t}process.loader.print("PostgreSQL installed!")}catch(s){throw console.error("Error installing PostgreSQL:",s),s}};var k=u;export{k as default};
