import{promisify as e}from"util";import{execFile as m,exec as y}from"child_process";import o from"fs";import w from"os";import i from"path";const r=e(m),_=e(y),u=e(o.mkdir),h=e(o.symlink),p=e(o.access),k=e(o.writeFile),b=async()=>{try{const t="16",g=`/usr/lib/postgresql/${t}/bin`,c=i.join(w.homedir(),".joystick","databases","postgresql","bin"),n=i.join(c,"bin"),l=i.join(n,"postgres");try{await p(l,o.constants.X_OK);return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await r("sudo",["apt-get","install","-y","wget"]),await r("sudo",["sh","-c",'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list']);const{stdout:d}=await _("wget -qO- https://www.postgresql.org/media/keys/ACCC4CF8.asc"),a="/tmp/postgresql-ACCC4CF8.asc";await k(a,d),await r("sudo",["apt-key","add",a]),await r("rm",[a]),await r("sudo",["apt-get","update"]),await r("sudo",["apt-get","install","-y",`postgresql-${t}`,`postgresql-client-${t}`,`postgresql-server-dev-${t}`]),await u(c,{recursive:!0});try{await h(g,n)}catch(s){if(s.code!=="EEXIST")throw console.error("Error creating symlink:",s),s}try{await p(l,o.constants.X_OK)}catch(s){throw console.error("Error accessing PostgreSQL executable:",s),s}process.loader.print("PostgreSQL installed!")}catch(t){throw console.error("Error installing PostgreSQL:",t),t}};var E=b;export{E as default};
//# sourceMappingURL=linux.js.map
