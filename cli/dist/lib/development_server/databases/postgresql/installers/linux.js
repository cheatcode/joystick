import{promisify as r}from"util";import{execFile as g}from"child_process";import t from"fs";import d from"os";import a from"path";const o=r(g),m=r(t.mkdir),y=r(t.symlink),l=r(t.access),_=async()=>{try{const p="/usr/lib/postgresql/16/bin",i=a.join(d.homedir(),".joystick","databases","postgresql","bin"),n=a.join(i,"bin"),c=a.join(n,"postgres");try{await l(c,t.constants.X_OK);return}catch{}process.loader.print("PostgreSQL not found. Installing... (this may take a few minutes)"),await o("sudo",["sh","-c",'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list']),await o("wget",["--quiet","-O","-","https://www.postgresql.org/media/keys/ACCC4CF8.asc","|","sudo","apt-key","add","-"]),await o("sudo",["apt-get","update"]),await o("sudo",["apt-get","install","-y","postgresql-16","postgresql-client-16","postgresql-server-dev-16"]),await m(i,{recursive:!0});try{await y(p,n)}catch(s){if(s.code!=="EEXIST")throw console.error("Error creating symlink:",s),s}try{await l(c,t.constants.X_OK)}catch(s){throw console.error("Error accessing PostgreSQL executable:",s),s}process.loader.print("PostgreSQL installed!")}catch(e){throw console.error("Error installing PostgreSQL:",e),e}};var k=_;export{k as default};
