{
  "version": 3,
  "sources": ["../../../../../src/lib/development_server/databases/postgresql/check_connection.js"],
  "sourcesContent": ["import fs from 'fs';\nimport postgresql from \"pg\";\nimport color_log from \"../../../color_log.js\";\n\nconst { Client } = postgresql;\nconst { readFile } = fs.promises;\n\nconst test_query = (client = {}) => {\n  return new Promise((resolve, reject) => {\n    client.query('SELECT NOW()', (error) => {\n      if (error) {\n        reject();\n      } else {\n        resolve();\n      }\n\n      client.end();\n    });\n  });\n};\n\nconst check_connection = async (connection = {}, options = {}) => {\n  try {\n    const host = connection?.hosts && connection?.hosts[0];\n    const connection_config = {\n      user: connection?.username,\n      host: host?.hostname,\n      database: connection?.database,\n      password: connection?.password,\n      port: host?.port,\n    };\n\n    if (options?.ssl?.ca) {\n      connection_config.ssl = {\n        ca: await readFile(options?.ssl?.ca)\n      };\n    }\n\n    const client = new Client(connection_config);\n\n    client.connect();\n    await test_query(client);\n\n    return true;\n  } catch (exception) {\n    console.warn(exception);\n  \tcolor_log(\n  \t\t`\\n\u2716 Failed to connect to PostgreSQL. Please double-check connection settings and try again.`,\n  \t\t'yellow'\n  \t);\n\n    process.exit(1);\n  }\n};\n\nexport default check_connection;\n"],
  "mappings": "AAAA,OAAOA,MAAQ,KACf,OAAOC,MAAgB,KACvB,OAAOC,MAAe,wBAEtB,KAAM,CAAE,OAAAC,CAAO,EAAIF,EACb,CAAE,SAAAG,CAAS,EAAIJ,EAAG,SAElBK,EAAa,CAACC,EAAS,CAAC,IACrB,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtCF,EAAO,MAAM,eAAiBG,GAAU,CAClCA,EACFD,EAAO,EAEPD,EAAQ,EAGVD,EAAO,IAAI,CACb,CAAC,CACH,CAAC,EAGGI,EAAmB,MAAOC,EAAa,CAAC,EAAGC,EAAU,CAAC,IAAM,CAChE,GAAI,CACF,MAAMC,EAAOF,GAAY,OAASA,GAAY,MAAM,CAAC,EAC/CG,EAAoB,CACxB,KAAMH,GAAY,SAClB,KAAME,GAAM,SACZ,SAAUF,GAAY,SACtB,SAAUA,GAAY,SACtB,KAAME,GAAM,IACd,EAEID,GAAS,KAAK,KAChBE,EAAkB,IAAM,CACtB,GAAI,MAAMV,EAASQ,GAAS,KAAK,EAAE,CACrC,GAGF,MAAMN,EAAS,IAAIH,EAAOW,CAAiB,EAE3C,OAAAR,EAAO,QAAQ,EACf,MAAMD,EAAWC,CAAM,EAEhB,EACT,OAASS,EAAW,CAClB,QAAQ,KAAKA,CAAS,EACvBb,EACC;AAAA,gGACA,QACD,EAEC,QAAQ,KAAK,CAAC,CAChB,CACF,EAEA,IAAOc,EAAQN",
  "names": ["fs", "postgresql", "color_log", "Client", "readFile", "test_query", "client", "resolve", "reject", "error", "check_connection", "connection", "options", "host", "connection_config", "exception", "check_connection_default"]
}
