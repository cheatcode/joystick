import i from"fs";import a from"path";import m from"os";import{promisify as s}from"util";import{pipeline as l}from"stream";import{execFile as d}from"child_process";const p=s(l),f=s(d),w=async()=>{const o=a.join(m.homedir(),".joystick","databases","mongodb"),t=a.join(o,"bin");if(await n(o))return;await _(o,t);const e="https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu2204-7.0.2.tgz",c=a.basename(new URL(e).pathname),r=a.join(o,c);await n(r)||(process.loader.print("MongoDB not found. Downloading... (this may take a few minutes)"),await u(e,r),process.loader.print("Installing MongoDB..."),await f("tar",["-xzf",r,"-C",t,"--strip-components=1"]),await i.promises.unlink(r),await y(t),process.loader.print("MongoDB installed!"))},u=async(o,t)=>{const e=await fetch(o);if(!e.ok)throw new Error(`Failed to download: ${e.statusText}`);await p(e.body,i.createWriteStream(t))},n=async o=>{try{return await i.promises.access(o),!0}catch{return!1}},_=async(o,t)=>{await i.promises.mkdir(o,{recursive:!0}),await i.promises.mkdir(t,{recursive:!0})},y=async o=>{const t=await i.promises.readdir(o);for(const e of t)await i.promises.chmod(a.join(o,e),"755")};var D=w;export{D as default};
