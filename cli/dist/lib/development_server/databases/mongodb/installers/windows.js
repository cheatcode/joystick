import e from"fs";import t from"path";import y from"os";import{promisify as p}from"util";import{pipeline as b}from"stream";import{execFile as x}from"child_process";const j=p(b),d=p(x),k=async()=>{const o=t.join(y.homedir(),".joystick","databases","mongodb"),i=t.join(o,"bin");if(await m(o))return;await v(o,i);const r="https://fastdl.mongodb.org/windows/mongodb-windows-x86_64-7.0.2.zip",l=t.basename(new URL(r).pathname),s=t.join(o,l);if(await m(s))return;process.loader.print("MongoDB not found. Downloading... (this may take a few minutes)"),await w(r,s),process.loader.print("Installing MongoDB...");const a=t.join(o,"temp");await d("powershell",["Expand-Archive","-Path",s,"-DestinationPath",a]);const h=(await e.promises.readdir(a))[0],f=t.join(a,h);await m(i)&&await e.promises.rm(i,{recursive:!0,force:!0}),await e.promises.cp(f,i,{recursive:!0});const _="https://downloads.mongodb.com/compass/mongosh-2.2.12-win32-x64.zip",c=t.join(o,"mongosh.zip");await w(_,c);const n=t.join(o,"mongosh_temp");await d("powershell",["Expand-Archive","-Path",c,"-DestinationPath",n]);const u=(await e.promises.readdir(n))[0],g=t.join(n,u,"bin","mongosh.exe");await e.promises.copyFile(g,t.join(i,"bin","mongosh.exe")),await e.promises.unlink(s),await e.promises.unlink(c),await e.promises.rm(a,{recursive:!0,force:!0}),await e.promises.rm(n,{recursive:!0,force:!0}),process.loader.print("MongoDB installed!")},w=async(o,i)=>{const r=await fetch(o);if(!r.ok)throw new Error(`Failed to download: ${r.statusText}`);await j(r.body,e.createWriteStream(i))},m=async o=>{try{return await e.promises.access(o),!0}catch{return!1}},v=async(o,i)=>{await e.promises.mkdir(o,{recursive:!0}),await e.promises.mkdir(i,{recursive:!0})};var M=k;export{M as default};
//# sourceMappingURL=windows.js.map
