import c from"../cli_log.js";import i from"./databases/provider_map.js";import d from"../types.js";const l=async(s="development",e={},r=2610,a=!1)=>{const t=i[e?.provider];t&&(process.env.NODE_ENV!=="test"&&process.loader.print(`Starting ${t?.name}${e?.name?` (${e?.name})`:""}...`),process._databases={...process._databases||{},[e.provider]:a?{...process._databases&&process._databases[e.provider]||{},[e?.name||`${e.provider}_${r}`]:await t.connect(e,r,s)}:await t.connect(e,r,s)})},p=async(s=[],e=2610,r="")=>{for(let a=0;a<s?.length;a+=1){const t=s[a],o=s?.filter(n=>n?.provider===n?.provider)?.length>1;await l(r,t,t?.port||e+a,o)}},u=(s=[])=>{const e=s.filter(o=>!d.is_object(o)),r=s.filter(o=>!!o.users),a=s.filter(o=>!!o.queues),t=s.filter(o=>!!o.sessions);return e&&e.length>0&&(c(`Please ensure that each database in the config.databases array in your settings.${process.env.NODE_ENV}.json is an object. Correct the array and restart your app.`,{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases"}),process.exit(1)),r&&r.length>1&&(c("Please select a single database for your user accounts and restart your app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#users"}),process.exit(1)),a&&a.length>1&&(c("Please select a single database for your queues and restart your app. If you need to spread queues across databases, use the database object on the queue definition instead (see documentation link below).",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#queues"}),process.exit(1)),t&&t.length>1&&(c("Please select a single database for your sessions and restart your app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#sessions"}),process.exit(1)),!0},f=async(s={})=>{const e=s?.settings?.config?.databases||[];e?.length>0&&(u(e),await p(e,s?.port+10,s?.environment))};var v=f;export{v as default};
//# sourceMappingURL=start_databases.js.map
