import c from"../cli_log.js";import n from"./databases/provider_map.js";import d from"../types.js";const l=async(s="development",e={},a=2610,r=!1)=>{const t=n[e?.provider];t&&(s!=="test"&&process.loader.print(`Starting ${t?.name}${e?.name?` (${e?.name})`:""}...`),process._databases={...process._databases||{},[e.provider]:r?{...process._databases&&process._databases[e.provider]||{},[e?.name||`${e.provider}_${a}`]:await t.connect(e,a,s)}:await t.connect(e,a,s)})},p=async(s=[],e=2610,a="")=>{for(let r=0;r<s?.length;r+=1){const t=s[r],o=s?.filter(i=>i?.provider===i?.provider)?.length>1;await l(a,t,t?.port||e+r,o)}},u=(s=[])=>{const e=s.filter(o=>!d.is_object(o)),a=s.filter(o=>!!o.users),r=s.filter(o=>!!o.queues),t=a.filter(o=>o.provider==="redis");return e&&e.length>0&&(c(`Please ensure that each database in the config.databases array in your settings.${process.env.NODE_ENV}.json is an object. Correct the array and restart your app.`,{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases"}),process.exit(1)),t&&t.length>0&&(c("Redis cannot be used for user accounts. Please use MongoDB or PostgreSQL for users and restart your app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#users"}),process.exit(1)),a&&a.length>1&&(c("Please select a single database for your user accounts and restart your app.",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#users"}),process.exit(1)),r&&r.length>1&&(c("Please select a single database for your queues and restart your app. If you need to spread queues across databases, use the database object on the queue definition instead (see documentation link below).",{level:"danger",docs:"https://cheatcode.co/docs/joystick/cli/databases#queues"}),process.exit(1)),!0},f=async(s={})=>{const e=s?.settings?.config?.databases||[];e?.length>0&&(u(e),await p(e,s?.port+10,s?.environment))};var b=f;export{b as default};
//# sourceMappingURL=start_databases.js.map
