import c from"esbuild";import d from"esbuild-plugin-svg";import s from"./plugins/index.js";import f from"./get_code_frame.js";import p from"../build/minify_file.js";import h from"./on_warn.js";import b from"../path_exists.js";const w=async(r={},e="")=>{const t=r?.errors&&r?.errors[0],o=await b(e)?await f(e,{line:t?.location?.line,column:t?.location?.column}):null;return await h({file:e,stack:r?.stack,line:t?.location?.line,column:t?.location?.column,snippet:o,lineWithError:t?.location?.lineText?.trim(),message:t?.text}),o},v=(r={})=>{const e=r?.message?.split(":");return e[2]&&e[2]?.includes("No loader")?e[3]&&e[3]?.replace(`
`,"")||"":e[1]&&e[1]?.replace(`
`,"")||""},u=async(r={})=>{const e=v(r),t=await w(r,e);return{success:!1,path:e,error:{stack:r?.stack,snippet:t}}},g=(r=[],e={})=>c.build({allowOverwrite:!0,platform:"node",format:"esm",bundle:!1,entryPoints:r?.map(t=>t.path),entryNames:"[dir]/[name]",outdir:e?.output_path||"./.joystick/build",outbase:"./",define:{"process.env.NODE_ENV":`'${e?.environment||"development"}'`},logLevel:"silent",plugins:[s.warn_node_environment,s.generate_file_dependency_map]}).catch(t=>{console.warn("NODE",t)}),y=(r=[],e={})=>c.build({allowOverwrite:!0,target:"es2020",platform:"browser",format:"esm",bundle:!0,entryPoints:r?.map(t=>t.path),entryNames:"[dir]/[name]",outbase:"./",outdir:e?.output_path||"./.joystick/build",define:{"process.env.NODE_ENV":`'${e?.environment||"development"}'`},logLevel:"silent",loader:{".svg":"text"},plugins:[s.warn_node_environment,s.generate_file_dependency_map,s.bootstrap_component,d()]}).catch(t=>{console.warn("BROWSER",t)}),N=async r=>{const e=[".DS_Store"],t=r?.files?.filter(n=>!e?.some(i=>n?.path?.includes(i)))?.filter(n=>n?.platform==="node"),o=r?.files?.filter(n=>!e?.some(i=>n?.path?.includes(i)))?.filter(n=>n?.platform==="browser");let l=[],a=[];t?.length>0&&(l=[await g(t,r).then(()=>({success:!0})).catch(n=>u(n))]),o?.length>0&&(a=[await y(o,r).then(()=>({success:!0})).catch(n=>u(n))]);const m=l?.some(n=>!n?.success),_=a?.some(n=>!n?.success);return m||_?Promise.reject([...l,...a]):(r?.environment&&r?.environment!=="development"&&await Promise.all([...o,...t].map(n=>p(`${r?.output_path||"./.joystick/build"}/${n.path}`))),[...l,...a])};var x=N;export{x as default};
