var t=(o="",e={})=>{throw new Error(`[joystick${o?`.${o}`:""}] ${e.message||e.reason||e}`)};var n=(o="",e=[])=>{try{console.error(`${o} failed with the following errors:`),e.forEach(r=>{console.log(r.message),r.stack&&console.log(r.stack)})}catch(r){t(o,r)}};var d=(o="{}")=>{try{return JSON.parse(o)}catch{return o}};var u=async(o={})=>{try{let e=await o.text();return d(e)}catch(e){t("api.set.handleParseResponse",e)}},w=(o={})=>{try{let e={...o};return e?.loader&&delete e.loader,JSON.stringify(e)}catch(e){t("api.set.getBody",e)}},S=(o="",e={})=>{try{return typeof window.fetch!="undefined"?new Promise((r,i)=>{let l=`${window.location.origin}/api/_setters/${o}`,f=w(e),_=document.querySelector('[name="csrf"]')?.getAttribute("content"),c={...e?.headers||{},"Content-Type":"application/json","x-joystick-csrf":_};return window?.__joystick_test__&&(c.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!0}),fetch(l,{method:"POST",mode:"cors",headers:c,body:f,credentials:"include"}).then(async a=>{let s=await u(a);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),s?.errors?(n("set request",s.errors),i(s)):r(s)}).catch(a=>(n("set request",[a]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),i({errors:[a]})))}):Promise.resolve()}catch(r){t("set request",r)}};export{S as default};
