var s=(t="",e={})=>{throw new Error(`[joystick${t?`.${t}`:""}] ${e.message||e.reason||e}`)};var i=(t="",e=[])=>{try{console.error(`${t} failed with the following errors:`),e.forEach(r=>{console.log(r.message),r.stack&&console.log(r.stack)})}catch(r){s(t,r)}};var p=(t="{}")=>{try{return JSON.parse(t)}catch{return t}};var f=(t={})=>Object.entries(t).map(([e,r])=>`${e}=${r}`)?.join("; ");var k=async(t={})=>{try{let e=await t.text();return p(e)}catch(e){s("api.get.handleParseResponse",e)}},_=(t="",e={})=>{try{return typeof window.fetch!="undefined"&&!e?.skip?new Promise((r,a)=>{let d=e.input?JSON.stringify(e.input):null,l=e.output?JSON.stringify(e.output):null,m=`${window.location.origin}/api/_getters/${t}?input=${d}&output=${l}`,c=document.querySelector('[name="csrf"]')?.getAttribute("content"),n={...e?.headers||{},"x-joystick-csrf":c};return window?.__joystick_test__&&(n.Cookie=f({joystickLoginToken:window.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expires_at__})),fetch(m,{method:"GET",mode:"cors",headers:n,credentials:"include"}).then(async o=>{let u=await k(o);return u?.errors?(i("get request",u.errors),a(u)):r(u)}).catch(o=>(i("get request",[o]),a({errors:[o]})))}):Promise.resolve()}catch(r){s("get request",r)}};var y=async(t={})=>{try{let e=await t.text();return p(e)}catch(e){s("api.set.handleParseResponse",e)}},h=(t={})=>{try{return JSON.stringify(t)}catch(e){s("api.set.getBody",e)}},w=(t="",e={})=>{try{return typeof window.fetch!="undefined"?new Promise((r,a)=>{let d=`${window.location.origin}/api/_setters/${t}`,l=h(e),m=document.querySelector('[name="csrf"]')?.getAttribute("content"),c={...e?.headers||{},"Content-Type":"application/json","x-joystick-csrf":m};return window?.__joystick_test__&&(c.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),fetch(d,{method:"POST",mode:"cors",headers:c,body:l,credentials:"include"}).then(async n=>{let o=await y(n);return o?.errors?(i("set request",o.errors),a(o)):r(o)}).catch(n=>(i("set request",[n]),a({errors:[n]})))}):Promise.resolve()}catch(r){s("set request",r)}};var O={get:_,set:w};export{O as default};
