var s=(o="",e={})=>{throw new Error(`[joystick${o?`.${o}`:""}] ${e.message||e.reason||e}`)};var a=(o="",e=[])=>{try{console.error(`${o} failed with the following errors:`),e.forEach(r=>{console.log(r.message),r.stack&&console.log(r.stack)})}catch(r){s(o,r)}};var l=(o="{}")=>{try{return JSON.parse(o)}catch{return o}};var w=(o={})=>Object.entries(o).map(([e,r])=>`${e}=${r}`)?.join("; ");var k=async(o={})=>{try{let e=await o.text();return l(e)}catch(e){s("api.get.handleParseResponse",e)}},m=(o="",e={})=>{try{return typeof window.fetch!="undefined"&&!e?.skip?new Promise((r,i)=>{let u=e.input?JSON.stringify(e.input):null,f=e.output?JSON.stringify(e.output):null,_=`${window.location.origin}/api/_getters/${o}?input=${u}&output=${f}`,c=document.querySelector('[name="csrf"]')?.getAttribute("content"),n={...e?.headers||{},"x-joystick-csrf":c};return window?.__joystick_test__&&(n.Cookie=w({joystickLoginToken:window.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expires_at__})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!0}),fetch(_,{method:"GET",mode:"cors",headers:n,credentials:"include"}).then(async t=>{let d=await k(t);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),d?.errors?(a("get request",d.errors),i(d)):r(d)}).catch(t=>(a("get request",[t]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),i({errors:[t]})))}):Promise.resolve()}catch(r){s("get request",r)}};var y=async(o={})=>{try{let e=await o.text();return l(e)}catch(e){s("api.set.handleParseResponse",e)}},h=(o={})=>{try{let e={...o};return e?.loader&&delete e.loader,JSON.stringify(e)}catch(e){s("api.set.getBody",e)}},p=(o="",e={})=>{try{return typeof window.fetch!="undefined"?new Promise((r,i)=>{let u=`${window.location.origin}/api/_setters/${o}`,f=h(e),_=document.querySelector('[name="csrf"]')?.getAttribute("content"),c={...e?.headers||{},"Content-Type":"application/json","x-joystick-csrf":_};return window?.__joystick_test__&&(c.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!0}),fetch(u,{method:"POST",mode:"cors",headers:c,body:f,credentials:"include"}).then(async n=>{let t=await y(n);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),t?.errors?(a("set request",t.errors),i(t)):r(t)}).catch(n=>(a("set request",[n]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${o}_loading`]:!1}),i({errors:[n]})))}):Promise.resolve()}catch(r){s("set request",r)}};var N={get:m,set:p};export{N as default};
