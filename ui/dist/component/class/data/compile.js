var o=(r="",t={})=>{throw new Error(`[joystick${r?`.${r}`:""}] ${t.message||t.reason||t}`)};var c=(r="",t=[])=>{try{console.error(`${r} failed with the following errors:`),t.forEach(e=>{console.log(e.message),e.stack&&console.log(e.stack)})}catch(e){o(r,e)}};var d=(r="{}")=>{try{return JSON.parse(r)}catch{return r}};var w=(r={})=>Object.entries(r).map(([t,e])=>`${t}=${e}`)?.join("; ");var b=async(r={})=>{try{let t=await r.text();return d(t)}catch(t){o("api.get.handleParseResponse",t)}},y=(r="",t={})=>{try{return typeof window.fetch!="undefined"&&!t?.skip?new Promise((e,i)=>{let s=t.input?JSON.stringify(t.input):null,f=t.output?JSON.stringify(t.output):null,l=`${window.location.origin}/api/_getters/${r}?input=${s}&output=${f}`,u=document.querySelector('[name="csrf"]')?.getAttribute("content"),a={...t?.headers||{},"x-joystick-csrf":u};return window?.__joystick_test__&&(a.Cookie=w({joystickLoginToken:window.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expires_at__})),fetch(l,{method:"GET",mode:"cors",headers:a,credentials:"include"}).then(async n=>{let p=await b(n);return p?.errors?(c("get request",p.errors),i(p)):e(p)}).catch(n=>(c("get request",[n]),i({errors:[n]})))}):Promise.resolve()}catch(e){o("get request",e)}};var E=async(r={})=>{try{let t=await r.text();return d(t)}catch(t){o("api.set.handleParseResponse",t)}},q=(r={})=>{try{return JSON.stringify(r)}catch(t){o("api.set.getBody",t)}},m=(r="",t={})=>{try{return typeof window.fetch!="undefined"?new Promise((e,i)=>{let s=`${window.location.origin}/api/_setters/${r}`,f=q(t),l=document.querySelector('[name="csrf"]')?.getAttribute("content"),u={...t?.headers||{},"Content-Type":"application/json","x-joystick-csrf":l};return window?.__joystick_test__&&(u.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),fetch(s,{method:"POST",mode:"cors",headers:u,body:f,credentials:"include"}).then(async a=>{let n=await E(a);return n?.errors?(c("set request",n.errors),i(n)):e(n)}).catch(a=>(c("set request",[a]),i({errors:[a]})))}):Promise.resolve()}catch(e){o("set request",e)}};var h={get:y,set:m};var _=r=>{try{return typeof r=="function"}catch(t){o("types.isFunction",t)}};var x=async(r={},t={},e={},i={})=>{try{if(i?.options?.data&&_(i.options.data)){let s=await i.options.data(r,t,e,i);return Promise.resolve(s)}return Promise.resolve()}catch(s){o("component.data.fetch",s)}};var k=(r="",t=[])=>{typeof window!="undefined"&&!!window.__joystick_test__&&(window.test={...window.test||{},functionCalls:{...window?.test?.functionCalls||{},[r]:[...window?.test?.functionCalls&&window?.test?.functionCalls[r]||[],{calledAt:new Date().toISOString(),args:t}]}})};var g="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890".split(""),F=(r=16)=>{let t="",e=0;for(;e<r;)t+=g[Math.floor(Math.random()*(g.length-1))],e+=1;return t};var j=(r={},t={},e={})=>{try{return{...r,refetch:async(i={})=>{k(`ui.${e?.options?.test?.name||F()}.data.refetch`,[i]);let s=await x(h,t,i,e);return e.data=j(s,t,e),window.__joystick_data__[e?.id]&&(window.__joystick_data__[e?.id]=s),window?.__joystick_test__||e.render({afterRefetchDataRender:()=>{e?.lifecycle?.onRefetchData&&e?.lifecycle?.onRefetchData(e)}}),e.data}}}catch(i){o("component.data.compile",i)}},ut=j;export{ut as default};
