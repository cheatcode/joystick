var o=(t="",e={})=>{throw new Error(`[joystick${t?`.${t}`:""}] ${e.message||e.reason||e}`)};var c=(t="",e=[])=>{try{console.error(`${t} failed with the following errors:`),e.forEach(r=>{console.log(r.message),r.stack&&console.log(r.stack)})}catch(r){o(t,r)}};var l=(t="{}")=>{try{return JSON.parse(t)}catch{return t}};var w=(t={})=>Object.entries(t).map(([e,r])=>`${e}=${r}`)?.join("; ");var b=async(t={})=>{try{let e=await t.text();return l(e)}catch(e){o("api.get.handleParseResponse",e)}},y=(t="",e={})=>{try{return typeof window.fetch!="undefined"&&!e?.skip?new Promise((r,i)=>{let s=e.input?JSON.stringify(e.input):null,f=e.output?JSON.stringify(e.output):null,p=`${window.location.origin}/api/_getters/${t}?input=${s}&output=${f}`,d=document.querySelector('[name="csrf"]')?.getAttribute("content"),a={...e?.headers||{},"x-joystick-csrf":d};return window?.__joystick_test__&&(a.Cookie=w({joystickLoginToken:window.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expires_at__})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!0}),fetch(p,{method:"GET",mode:"cors",headers:a,credentials:"include"}).then(async n=>{let u=await b(n);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!1}),u?.errors?(c("get request",u.errors),i(u)):r(u)}).catch(n=>(c("get request",[n]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!1}),i({errors:[n]})))}):Promise.resolve()}catch(r){o("get request",r)}};var E=async(t={})=>{try{let e=await t.text();return l(e)}catch(e){o("api.set.handleParseResponse",e)}},S=(t={})=>{try{let e={...t};return e?.loader&&delete e.loader,JSON.stringify(e)}catch(e){o("api.set.getBody",e)}},_=(t="",e={})=>{try{return typeof window.fetch!="undefined"?new Promise((r,i)=>{let s=`${window.location.origin}/api/_setters/${t}`,f=S(e),p=document.querySelector('[name="csrf"]')?.getAttribute("content"),d={...e?.headers||{},"Content-Type":"application/json","x-joystick-csrf":p};return window?.__joystick_test__&&(d.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!0}),fetch(s,{method:"POST",mode:"cors",headers:d,body:f,credentials:"include"}).then(async a=>{let n=await E(a);return e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!1}),n?.errors?(c("set request",n.errors),i(n)):r(n)}).catch(a=>(c("set request",[a]),e?.loader?.instance&&e?.loader?.instance?.setState({[e?.loader?.state||`${t}_loading`]:!1}),i({errors:[a]})))}):Promise.resolve()}catch(r){o("set request",r)}};var h={get:y,set:_};var m=t=>{try{return typeof t=="function"}catch(e){o("types.isFunction",e)}};var x=async(t={},e={},r={},i={})=>{try{if(i?.options?.data&&m(i.options.data)){let s=await i.options.data(t,e,r,i);return Promise.resolve(s)}return Promise.resolve()}catch(s){o("component.data.fetch",s)}};var k=(t="",e=[])=>{typeof window!="undefined"&&!!window.__joystick_test__&&(window.test={...window.test||{},functionCalls:{...window?.test?.functionCalls||{},[t]:[...window?.test?.functionCalls&&window?.test?.functionCalls[t]||[],{calledAt:new Date().toISOString(),args:e}]}})};var g="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890".split(""),F=(t=16)=>{let e="",r=0;for(;r<t;)e+=g[Math.floor(Math.random()*(g.length-1))],r+=1;return e};var j=(t={},e={},r={})=>{try{return{...t,refetch:async(i={})=>{k(`ui.${r?.options?.test?.name||F()}.data.refetch`,[i]);let s=await x(h,e,i,r);return r.data=j(s,e,r),window.__joystick_data__[r?.id]&&(window.__joystick_data__[r?.id]=s),window?.__joystick_test__||r.render({afterRefetchDataRender:()=>{r?.lifecycle?.onRefetchData&&r?.lifecycle?.onRefetchData(r)}}),r.data}}}catch(i){o("component.data.compile",i)}},de=j;export{de as default};
