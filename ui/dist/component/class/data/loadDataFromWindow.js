var o=(r="",t={})=>{throw new Error(`[joystick${r?`.${r}`:""}] ${t.message||t.reason||t}`)};var l=()=>typeof window=="undefined";var c=(r="",t=[])=>{try{console.error(`${r} failed with the following errors:`),t.forEach(e=>{console.log(e.message),e.stack&&console.log(e.stack)})}catch(e){o(r,e)}};var p=(r="{}")=>{try{return JSON.parse(r)}catch{return r}};var y=(r={})=>Object.entries(r).map(([t,e])=>`${t}=${e}`)?.join("; ");var q=async(r={})=>{try{let t=await r.text();return p(t)}catch(t){o("api.get.handleParseResponse",t)}},m=(r="",t={})=>{try{return typeof window.fetch!="undefined"&&!t?.skip?new Promise((e,i)=>{let s=t.input?JSON.stringify(t.input):null,w=t.output?JSON.stringify(t.output):null,f=`${window.location.origin}/api/_getters/${r}?input=${s}&output=${w}`,u=document.querySelector('[name="csrf"]')?.getAttribute("content"),a={...t?.headers||{},"x-joystick-csrf":u};return window?.__joystick_test__&&(a.Cookie=y({joystickLoginToken:window.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expires_at__})),fetch(f,{method:"GET",mode:"cors",headers:a,credentials:"include"}).then(async n=>{let d=await q(n);return d?.errors?(c("get request",d.errors),i(d)):e(d)}).catch(n=>(c("get request",[n]),i({errors:[n]})))}):Promise.resolve()}catch(e){o("get request",e)}};var R=async(r={})=>{try{let t=await r.text();return p(t)}catch(t){o("api.set.handleParseResponse",t)}},N=(r={})=>{try{return JSON.stringify(r)}catch(t){o("api.set.getBody",t)}},_=(r="",t={})=>{try{return typeof window.fetch!="undefined"?new Promise((e,i)=>{let s=`${window.location.origin}/api/_setters/${r}`,w=N(t),f=document.querySelector('[name="csrf"]')?.getAttribute("content"),u={...t?.headers||{},"Content-Type":"application/json","x-joystick-csrf":f};return window?.__joystick_test__&&(u.Cookie=generateCookieHeader({joystickLoginToken:window?.__joystick_test_login_token__,joystickLoginTokenExpiresAt:window.__joystick_test_login_token_expirs_at__})),fetch(s,{method:"POST",mode:"cors",headers:u,body:w,credentials:"include"}).then(async a=>{let n=await R(a);return n?.errors?(c("set request",n.errors),i(n)):e(n)}).catch(a=>(c("set request",[a]),i({errors:[a]})))}):Promise.resolve()}catch(e){o("set request",e)}};var h={get:m,set:_};var x=r=>{try{return typeof r=="function"}catch(t){o("types.isFunction",t)}};var k=async(r={},t={},e={},i={})=>{try{if(i?.options?.data&&x(i.options.data)){let s=await i.options.data(r,t,e,i);return Promise.resolve(s)}return Promise.resolve()}catch(s){o("component.data.fetch",s)}};var g=(r="",t=[])=>{typeof window!="undefined"&&!!window.__joystick_test__&&(window.test={...window.test||{},functionCalls:{...window?.test?.functionCalls||{},[r]:[...window?.test?.functionCalls&&window?.test?.functionCalls[r]||[],{calledAt:new Date().toISOString(),args:t}]}})};var F="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890".split(""),j=(r=16)=>{let t="",e=0;for(;e<r;)t+=F[Math.floor(Math.random()*(F.length-1))],e+=1;return t};var b=(r={},t={},e={})=>{try{return{...r,refetch:async(i={})=>{g(`ui.${e?.options?.test?.name||j()}.data.refetch`,[i]);let s=await k(h,t,i,e);return e.data=b(s,t,e),window.__joystick_data__[e?.id]&&(window.__joystick_data__[e?.id]=s),window?.__joystick_test__||e.render({afterRefetchDataRender:()=>{e?.lifecycle?.onRefetchData&&e?.lifecycle?.onRefetchData(e)}}),e.data}}}catch(i){o("component.data.compile",i)}},E=b;var lt=(r={})=>{try{if(!l()){let t=window.__joystick_data__&&window.__joystick_data__[r?.id]||{},e=window.__joystick_req__||{};return E(t,e,r)}return r?.data||{}}catch(t){o("component.loadDataFromWindow",t)}};export{lt as default};
