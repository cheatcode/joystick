var fr=Object.create;var v=Object.defineProperty;var mr=Object.getOwnPropertyDescriptor;var hr=Object.getOwnPropertyNames;var wr=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var xr=r=>v(r,"__esModule",{value:!0});var Mr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Tr=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of hr(e))!yr.call(r,o)&&o!=="default"&&v(r,o,{get:()=>e[o],enumerable:!(t=mr(e,o))||t.enumerable});return r},Fr=r=>Tr(xr(v(r!=null?fr(wr(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var G=Mr(D=>{(function(r,e){if(typeof define=="function"&&define.amd)define(["exports"],e);else if(typeof D!="undefined")e(D);else{var t={exports:{}};e(t.exports),r.index=t.exports}})(D,function(r){"use strict";function e(a){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e(a)}function t(a,c){return c&&(e(c)==="object"||typeof c=="function")?c:o(a)}function o(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function n(a){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},n(a)}function s(a,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),c&&T(a,c)}function T(a,c){return T=Object.setPrototypeOf||function(p,x){return p.__proto__=x,p},T(a,c)}function u(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.diff=void 0;var S=function a(c,p){u(this,a),this.type=c,this.path=p?p.toString():""},k=function(a){function c(p,x,d){var F;return u(this,c),F=t(this,n(c).call(this,"E",p)),F.lhs=x,F.rhs=d,F}return s(c,a),c}(S),C=function(a){function c(p,x,d,F){var f;return u(this,c),f=t(this,n(c).call(this,"M",p)),f.item=x,f.lhsIndex=d,f.rhsIndex=F,f}return s(c,a),c}(S),A=function(a){function c(p,x){var d;return u(this,c),d=t(this,n(c).call(this,"D",p)),d.lhs=x,d}return s(c,a),c}(S),H=function(a){function c(p,x){var d;return u(this,c),d=t(this,n(c).call(this,"A",p)),d.rhs=x,d}return s(c,a),c}(S),E=function(a,c){return a?"".concat(a,".").concat(c):c};r.diff=function(c,p){var x=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},d=[],F=x.matchKey,f=x.types||["E","A","D","M"],pr=function(m,l,h,b){m.forEach(function(g,w){var M=l.findIndex(function(y){return y[b]===g[b]});-1<M?(-1<f.indexOf("M")&&w!==M&&d.push(new C(h,g,w,M)),R(g,l[M],E(h,M))):-1<f.indexOf("D")&&d.push(new A(h,g))}),l.forEach(function(g,w){var M=m.findIndex(function(y){return g[b]===y[b]});-1<f.indexOf("A")&&M===-1&&d.push(new H(E(h,w),g))})},R=function(m,l,h){var b=Object.prototype.toString.call(m),g=Object.prototype.toString.call(l);if(-1<f.indexOf("E")&&b!==g)return d.push(new k(h,m,l)),!1;if(b==="[object Object]")Object.getOwnPropertyNames(m).forEach(function(y){Object.prototype.hasOwnProperty.call(l,y)?R(m[y],l[y],E(h,y)):-1<f.indexOf("D")&&d.push(new A(E(h,y),m[y]))}),Object.getOwnPropertyNames(l).forEach(function(y){-1<f.indexOf("A")&&!Object.prototype.hasOwnProperty.call(m,y)&&d.push(new H(E(h,y),l[y]))});else if(b!=="[object Array]")-1<f.indexOf("E")&&m!==l&&d.push(new k(h,m,l));else if(F)pr(m,l,h,F);else{var w=m.length-1,M=l.length-1;if(-1<f.indexOf("D"))for(;w>M;)d.push(new A(E(h,w),m[w--]));if(-1<f.indexOf("A"))for(;M>w;)d.push(new H(E(h,M),l[M--]));for(;0<=w;--w)R(m[w],l[w],E(h,w))}};return R(c,p),d}})});var i=(r="",e={})=>{throw new Error(`[joystick${r?`.${r}`:""}] ${e.message||e.reason||e}`)};var $=r=>{try{return!!Array.isArray(r)}catch(e){i("types.isArray",e)}};var q=r=>{try{return typeof r=="function"}catch(e){i("types.isFunction",e)}};var B=r=>{try{return!!(r&&typeof r=="object"&&!Array.isArray(r))}catch(e){i("types.isObject",e)}};var W=r=>{try{return typeof r=="string"}catch(e){i("types.isString",e)}};var z=(r=[],e="")=>{try{return($(r)&&r.find(o=>o?.componentId===e))?.data||{}}catch(t){i("findComponentDataFromSSR",t)}};var J=Fr(G());var j=()=>typeof window=="undefined";var gr=(r="")=>{try{let[e,t]=r?.split(".");return t?window?.joystick?._internal?.queues[e][t]:window?.joystick?._internal?.queues[e]}catch(e){i("addToQueue.getQueue",e)}},O=(r="",e=null)=>{try{j()||(gr(r)||{}).array.push({callback:e})}catch(t){i("addToQueue",t)}};var Q=(r={},e="",t="id")=>{try{let o=r&&r.id;if(B(r)&&o){let n=Object.keys(r);for(let s=0;s<n.length;s+=1){let T=n[s],u=r[T];if(T===t&&u===e)return r;if(T==="children"&&Array.isArray(u))for(let S=0;S<u.length;S+=1){let k=u[S],C=Q(k,e,t);if(C!==null)return C}}}return null}catch(o){i("component.findComponentInTreeByField",o)}},V=Q;var K=(r="",e={},t=null)=>{let o=V(t||window.joystick._internal.tree,r,"instanceId");o&&(o.children=[...o.children||[],e])};var X=(r={},e={})=>{try{return Object.entries(e).reduce((t={},[o,n])=>(t[o]=(...s)=>n(...s,{...r,setState:r.setState.bind(r),...r.renderMethods||{}}),t),{})}catch{i("component.methods.compile")}};var Sr=(r={},e={},t=null)=>{try{let o=L(r,{includeActual:!0,existingChildren:t});return r.dom=o,r.setDOMNodeOnInstance(),r.appendCSSToHead(),e.renderedComponent=r,o.html.wrapped}catch(o){i("component.renderMethods.component.renderForClient",o)}},Er=(r={})=>{try{return r.renderToHTML({ssrTree:r.parent.ssrTree,translations:r.parent.translations,walkingTreeForSSR:r?.parent?.walkingTreeForSSR,dataFromSSR:r.parent?.dataFromSSR}).wrapped}catch(e){i("component.renderMethods.component.renderToHTMLForSSR",e)}},br=(r={})=>{try{return r.parent.ssrTree.dataFunctions.push(async()=>{let e=await r.options.data(r.parent.options.api,r.parent.options.req);return r.data=e||{},{componentId:r.id,ssrId:r.ssrId,data:e}}),r.renderToHTML({ssrTree:r?.parent?.ssrTree,translations:r?.parent?.translations,walkingTreeForSSR:r?.parent?.walkingTreeForSSR,dataFromSSR:r?.parent?.dataFromSSR})}catch(e){i("component.renderMethods.component.collectDataFunctionsForSSR",e)}},Or=(r={})=>{try{let e={id:r.id,instanceId:r.instanceId,instance:r,children:[]};K(r.parent.instanceId,e,r.parent&&r.parent.ssrTree||null)}catch(e){i("component.renderMethods.component.handleAddComponentToParent",e)}},kr=(r={},e={})=>{try{!r.renderedComponent&&e.options&&e.options.lifecycle&&(e.options.lifecycle.onBeforeMount&&O("lifecycle.onBeforeMount",()=>{e.options.lifecycle.onBeforeMount(e)}),!r.renderedComponent&&e.options.lifecycle.onMount&&O("lifecycle.onMount",()=>{e.options.lifecycle.onMount(e)}))}catch(t){i("component.renderMethods.component.handleLifecycle",t)}},Cr=(r={},e={},t={})=>{try{!e.walkingTreeForSSR&&r?.options?.lifecycle?.onUpdateProps&&(0,J.diff)(e?.existingPropsMap,t)?.length>0&&O("lifecycle.onUpdateProps",()=>{let n=e?.existingPropsMap&&e?.existingPropsMap[r.id];r.options.lifecycle.onUpdateProps(n||{},t,r)})}catch(o){i("component.renderMethods.component.handleOnChangeProps",o)}},Rr=function(){return function(e=null,t={},o={}){let n=e({props:t,url:o.url,translations:o.translations,api:o.options.api,req:o.options.req,dataFromSSR:o?.dataFromSSR,parent:o}),s=o?.existingStateMap[n.id]||{},T=o.children[n.id]||[],u=s[T?.length];return n.state=u?.state||n.state,o.children[n.id]=[...o.children[n.id]||[],n],n.parent=o,Cr(n,o,t),O("lifecycle.onMount",()=>{n.setDOMNodeOnInstance()}),kr(this,n),n.parent&&Or(n),n.options.data&&n.parent.walkingTreeForSSR&&n.parent.ssrTree.dataFunctions?br(n):n.parent&&n.parent.ssrTree?Er(n):Sr(n,this,u?.children)}},Dr=function(e,t){try{let o=this;return new Rr().bind({})(e,t,o)}catch(o){i("component.renderMethods.component",o)}},N=Dr;var jr=function(e=[],t=null){try{return q(t)&&e&&Array.isArray(e)?e.map((o,n)=>t(o,n)).join(""):""}catch(o){i("component.renderMethods.each",o)}},P=jr;var Lr=function(e="",t={}){try{let o=j()?this.translations:window.__joystick_i18n__;if(!o||!o[e])return"";let n=Object.entries(t);return n.length>0?n.reduce((s,[T,u])=>s.replace(`{{${T}}}`,u),o[e]):o[e]}catch(o){i("component.renderMethods.i18n",o)}},_=Lr;var Ar=function(e=!1,t=""){try{return this?.renderingHTMLWithDataForSSR||e?`<when>${t.trim()}</when>`:"<when> </when>"}catch(o){i("component.renderMethods.when",o)}},I=Ar;var Y={c:N,component:N,e:P,each:P,i:_,i18n:_,w:I,when:I};var Z=(r={},e={})=>{try{return Object.entries(Y).reduce((t,[o,n])=>(t[o]=n.bind({...r,...e}),t),{})}catch(t){i("component.renderMethods.compile",t)}};var rr=(r={})=>{try{return Object.entries(r)?.reduce((e={},[t,o]={})=>(e[t]=o?.map((n={})=>({state:n?.state,children:rr(n?.children)})),e),{})}catch(e){i("component.render.getExistingStateMap.buildMapForChildren",e)}},er=(r={})=>{try{return rr(r)}catch(e){i("component.render.getExistingStateMap",e)}};var tr=new RegExp(/\<\!\-\-(?:.|\n|\r)*?-->/g),Hr=new RegExp(/\n/g);var vr=(r="")=>{try{return(r.match(tr)||[]).forEach(t=>{r=r.replace(t,"")}),r}catch(e){i("component.render.sanitizeHTML.removeCommentedCode",e)}},or=(r="")=>{try{let e=`${r}`;return e=vr(e),e}catch(e){i("component.render.sanitizeHTML",e)}};var nr=(r={},e="")=>{try{let{wrapper:t=null,ssrId:o=null,id:n=null,instanceId:s=null}=r;return`<div ${t?.id?`id="${t.id}" `:""}${t?.classList?`class="${t.classList?.join(" ")}" `:""}js-ssrId="${o}" js-c="${n}" js-i="${s}">${e}</div>`}catch(t){i("component.render.wrapHTML",t)}};var ir=(r={},e={})=>{try{e?.dataFromSSR&&(r.data=z(e.dataFromSSR,r.id)||{});let t=er(e?.existingChildren||r?.children)||{};r.children={},r.renderMethods=Z({...r,existingStateMap:t,translations:e?.translations||r.translations||{},ssrTree:e?.ssrTree,walkingTreeForSSR:e?.walkingTreeForSSR,renderingHTMLWithDataForSSR:e?.renderingHTMLWithDataForSSR,dataFromSSR:e?.dataFromSSR}),r.methods=X(r,r.options.methods);let o=r.options.render({...r||{},setState:r.setState.bind(r),...r.renderMethods||{}}),n=or(o),s=nr(r,n);return{unwrapped:n,wrapped:s}}catch(t){i("component.render.toHTML",t)}};var Nr=(r={})=>{try{return Object.values(r).reduce((e={},t)=>(e[t.name]=t.value,e),{})}catch(e){i("component.virtualDOM.build.parseAttributeMap",e)}},cr=(r={})=>{try{return r.tagName==="WHEN"?[].flatMap.call(r?.childNodes,e=>e?.tagName==="WHEN"?cr(e):U(e)):U(r)}catch(e){i("component.virtualDOM.build.flattenWhenTags",e)}},U=(r={})=>{try{let e=r&&r.tagName&&r.tagName.toLowerCase()||"text",t={tagName:e,attributes:Nr(r.attributes),children:[].flatMap.call(r.childNodes,o=>cr(o))};return e==="text"&&(t=r.textContent),t}catch(e){i("component.virtualDOM.build",e)}},ar=U;var Pr=(r="",e="")=>{try{let t=document.createElement("div");return t.setAttribute("js-c",e),t.innerHTML=r,t}catch(t){i("component.virtualDOM.build.convertHTMLToDOM",t)}},sr=(r="",e="")=>{try{let t=Pr(r,e);return ar(t)}catch(t){i("component.virtualDOM.build",t)}};var dr=(r="")=>{try{return document.createElement("div").setAttribute(r,"Test"),!0}catch{return!1}};var _r=(r={})=>{try{let e=document.createElement(r.tagName),t=Object.entries(r.attributes);for(let o=0;o<t.length;o+=1){let[n,s]=t[o];dr(n)&&e.setAttribute(n,s)}for(let o=0;o<r?.children?.length;o+=1){let n=r?.children[o];if(n){let s=lr(n);e.appendChild(s)}}return e}catch(e){i("component.virtualDOM.renderTreeToDOM.renderElement",e)}},lr=(r=null)=>{try{return W(r)?document.createTextNode(r):_r(r)}catch(e){i("component.virtualDOM.renderTreeToDOM",e)}},ur=lr;var L=(r={},e={})=>{try{let t=ir(r,{existingChildren:e?.existingChildren}),o=sr(t.unwrapped,r.id),n=e.includeActual&&o?ur(o):null;return{html:t,virtual:o,actual:n}}catch(t){i("component.render.getUpdatedDOM",t)}};var Mt=(r={})=>{try{let e=L(r,{includeActual:!0});return r.dom=e,e.actual}catch(e){i("component.render.forMount",e)}};export{Mt as default};
