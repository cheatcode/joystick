var Or=Object.create;var _=Object.defineProperty;var Sr=Object.getOwnPropertyDescriptor;var Dr=Object.getOwnPropertyNames;var kr=Object.getPrototypeOf,vr=Object.prototype.hasOwnProperty;var Cr=e=>_(e,"__esModule",{value:!0});var Lr=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var jr=(e,r,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Dr(r))!vr.call(e,n)&&n!=="default"&&_(e,n,{get:()=>r[n],enumerable:!(t=Sr(r,n))||t.enumerable});return e},Ir=e=>jr(Cr(_(e!=null?Or(kr(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var X=Lr(I=>{(function(e,r){if(typeof define=="function"&&define.amd)define(["exports"],r);else if(typeof I!="undefined")r(I);else{var t={exports:{}};r(t.exports),e.index=t.exports}})(I,function(e){"use strict";function r(d){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},r(d)}function t(d,s){return s&&(r(s)==="object"||typeof s=="function")?s:n(d)}function n(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function o(d){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},o(d)}function a(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(s&&s.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),s&&c(d,s)}function c(d,s){return c=Object.setPrototypeOf||function(f,M){return f.__proto__=M,f},c(d,s)}function p(d,s){if(!(d instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.diff=void 0;var x=function d(s,f){p(this,d),this.type=s,this.path=f?f.toString():""},C=function(d){function s(f,M,l){var E;return p(this,s),E=t(this,o(s).call(this,"E",f)),E.lhs=M,E.rhs=l,E}return a(s,d),s}(x),L=function(d){function s(f,M,l,E){var m;return p(this,s),m=t(this,o(s).call(this,"M",f)),m.item=M,m.lhsIndex=l,m.rhsIndex=E,m}return a(s,d),s}(x),A=function(d){function s(f,M){var l;return p(this,s),l=t(this,o(s).call(this,"D",f)),l.lhs=M,l}return a(s,d),s}(x),P=function(d){function s(f,M){var l;return p(this,s),l=t(this,o(s).call(this,"A",f)),l.rhs=M,l}return a(s,d),s}(x),O=function(d,s){return d?"".concat(d,".").concat(s):s};e.diff=function(s,f){var M=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},l=[],E=M.matchKey,m=M.types||["E","A","D","M"],Fr=function(h,u,g,S){h.forEach(function(F,w){var b=u.findIndex(function(y){return y[S]===F[S]});-1<b?(-1<m.indexOf("M")&&w!==b&&l.push(new L(g,F,w,b)),j(F,u[b],O(g,b))):-1<m.indexOf("D")&&l.push(new A(g,F))}),u.forEach(function(F,w){var b=h.findIndex(function(y){return F[S]===y[S]});-1<m.indexOf("A")&&b===-1&&l.push(new P(O(g,w),F))})},j=function(h,u,g){var S=Object.prototype.toString.call(h),F=Object.prototype.toString.call(u);if(-1<m.indexOf("E")&&S!==F)return l.push(new C(g,h,u)),!1;if(S==="[object Object]")Object.getOwnPropertyNames(h).forEach(function(y){Object.prototype.hasOwnProperty.call(u,y)?j(h[y],u[y],O(g,y)):-1<m.indexOf("D")&&l.push(new A(O(g,y),h[y]))}),Object.getOwnPropertyNames(u).forEach(function(y){-1<m.indexOf("A")&&!Object.prototype.hasOwnProperty.call(h,y)&&l.push(new P(O(g,y),u[y]))});else if(S!=="[object Array]")-1<m.indexOf("E")&&h!==u&&l.push(new C(g,h,u));else if(E)Fr(h,u,g,E);else{var w=h.length-1,b=u.length-1;if(-1<m.indexOf("D"))for(;w>b;)l.push(new A(O(g,w),h[w--]));if(-1<m.indexOf("A"))for(;b>w;)l.push(new P(O(g,b),u[b--]));for(;0<=w;--w)j(h[w],u[w],O(g,w))}};return j(s,f),l}})});var i=(e="",r={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${r.message||r.reason||r}`)};var z=e=>{try{return!!Array.isArray(e)}catch(r){i("types.isArray",r)}};var T=e=>{try{return typeof e=="function"}catch(r){i("types.isFunction",r)}};var Q=e=>{try{return!!(e&&typeof e=="object"&&!Array.isArray(e))}catch(r){i("types.isObject",r)}};var V=e=>{try{return typeof e=="string"}catch(r){i("types.isString",r)}};var K=(e=[],r="")=>{try{return(z(e)&&e.find(n=>n?.componentId===r))?.data||{}}catch(t){i("findComponentDataFromSSR",t)}};var rr=Ir(X());var D=()=>typeof window=="undefined";var Rr=(e="")=>{try{let[r,t]=e?.split(".");return t?window?.joystick?._internal?.queues[r][t]:window?.joystick?._internal?.queues[r]}catch(r){i("addToQueue.getQueue",r)}},v=(e="",r=null)=>{try{D()||(Rr(e)||{}).array.push({callback:r})}catch(t){i("addToQueue",t)}};var J=(e={},r="",t="id")=>{try{let n=e&&e.id;if(Q(e)&&n){let o=Object.keys(e);for(let a=0;a<o.length;a+=1){let c=o[a],p=e[c];if(c===t&&p===r)return e;if(c==="children"&&Array.isArray(p))for(let x=0;x<p.length;x+=1){let C=p[x],L=J(C,r,t);if(L!==null)return L}}}return null}catch(n){i("component.findComponentInTreeByField",n)}},k=J;var Y=(e="",r={},t=null)=>{let n=k(t||window.joystick._internal.tree,e,"instanceId");n&&(n.children=[...n.children||[],r])};var Z=(e={},r={})=>{try{return Object.entries(r).reduce((t={},[n,o])=>(t[n]=(...a)=>o(...a,{...e,setState:e.setState.bind(e),...e.renderMethods||{}}),t),{})}catch{i("component.methods.compile")}};var Nr=(e={},r={},t=null)=>{try{let n=R(e,{includeActual:!0,existingChildren:t});return e.dom=n,e.setDOMNodeOnInstance(),e.appendCSSToHead(),r.renderedComponent=e,n.html.wrapped}catch(n){i("component.renderMethods.component.renderForClient",n)}},Hr=(e={})=>{try{return e.renderToHTML({ssrTree:e.parent.ssrTree,translations:e.parent.translations,walkingTreeForSSR:e?.parent?.walkingTreeForSSR,dataFromSSR:e.parent?.dataFromSSR}).wrapped}catch(r){i("component.renderMethods.component.renderToHTMLForSSR",r)}},Ar=(e={})=>{try{return e.parent.ssrTree.dataFunctions.push(async()=>{let r=await e.options.data(e.parent.options.api,e.parent.options.req);return e.data=r||{},{componentId:e.id,ssrId:e.ssrId,data:r}}),e.renderToHTML({ssrTree:e?.parent?.ssrTree,translations:e?.parent?.translations,walkingTreeForSSR:e?.parent?.walkingTreeForSSR,dataFromSSR:e?.parent?.dataFromSSR})}catch(r){i("component.renderMethods.component.collectDataFunctionsForSSR",r)}},Pr=(e={})=>{try{let r={id:e.id,instanceId:e.instanceId,instance:e,children:[]};Y(e.parent.instanceId,r,e.parent&&e.parent.ssrTree||null)}catch(r){i("component.renderMethods.component.handleAddComponentToParent",r)}},_r=(e={},r={})=>{try{!e.renderedComponent&&r.options&&r.options.lifecycle&&(r.options.lifecycle.onBeforeMount&&v("lifecycle.onBeforeMount",()=>{r.options.lifecycle.onBeforeMount(r)}),!e.renderedComponent&&r.options.lifecycle.onMount&&v("lifecycle.onMount",()=>{r.options.lifecycle.onMount(r)}))}catch(t){i("component.renderMethods.component.handleLifecycle",t)}},$r=(e={},r={},t={})=>{try{!r.walkingTreeForSSR&&e?.options?.lifecycle?.onUpdateProps&&(0,rr.diff)(r?.existingPropsMap,t)?.length>0&&v("lifecycle.onUpdateProps",()=>{let o=r?.existingPropsMap&&r?.existingPropsMap[e.id];e.options.lifecycle.onUpdateProps(o||{},t,e)})}catch(n){i("component.renderMethods.component.handleOnChangeProps",n)}},Br=function(){return function(r=null,t={},n={}){let o=r({props:t,url:n.url,translations:n.translations,api:n.options.api,req:n.options.req,dataFromSSR:n?.dataFromSSR,parent:n}),a=n?.existingStateMap[o.id]||{},c=n.children[o.id]||[],p=a[c?.length];return o.state=p?.state||o.state,n.children[o.id]=[...n.children[o.id]||[],o],o.parent=n,$r(o,n,t),v("lifecycle.onMount",()=>{o.setDOMNodeOnInstance()}),_r(this,o),o.parent&&Pr(o),o.options.data&&o.parent.walkingTreeForSSR&&o.parent.ssrTree.dataFunctions?Ar(o):o.parent&&o.parent.ssrTree?Hr(o):Nr(o,this,p?.children)}},Ur=function(r,t){try{let n=this;return new Br().bind({})(r,t,n)}catch(n){i("component.renderMethods.component",n)}},$=Ur;var N=(e={},r={})=>{Object.entries(e).forEach(([t,n])=>{r[t]=n})};var er="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890".split(""),tr=(e=16)=>{let r="",t=0;for(;t<e;)r+=er[Math.floor(Math.random()*(er.length-1))],t+=1;return r};var H=(e={},r="",t="",n={})=>{try{let o=null;e.dragDrop={...e.dragDrop||{},events:{...e.dragDrop?.events||{},[`drag [data-${r}="${t}"]`]:(a={},c={})=>{n?.events?.onDrag&&T(n.events.onDrag)&&n.events.onDrag(a,c)},[`dragend [data-${r}="${t}"]`]:(a={},c={})=>{r==="droppable"&&n.sortable&&(a.target.classList.remove("is-dragging"),o=null),n?.events?.onDragEnd&&T(n.events.onDragEnd)&&n.events.onDragEnd(a,c)},[`dragenter [data-${r}="${t}"]`]:(a={},c={})=>{n?.events?.onDragEnter&&T(n.events.onDragEnter)&&n.events.onDragEnter(a,c)},[`dragleave [data-${r}="${t}"]`]:(a={},c={})=>{n?.events?.onDragLeave&&T(n.events.onDragLeave)&&n.events.onDragLeave(a,c)},[`dragover [data-${r}="${t}"]`]:(a={},c={})=>{r==="droppable"&&n.sortable&&a.target.parentNode.hasAttribute("data-droppable")&&(o.compareDocumentPosition(a.target)===Node.DOCUMENT_POSITION_PRECEDING?(o.style=`transform: translate3d(0px, ${a.target.top-o.top}px, 0px);`,a.target.parentNode.insertBefore(o,a.target),a.target.style=""):(o.style=`transform: translate3d(0px, ${o.top-a.target.nextSibling.top}px, 0px);`,a.target.parentNode.insertBefore(o,a.target.nextSibling)),o.style=""),n?.events?.onDragOver&&T(n.events.onDragOver)&&n.events.onDragOver(a,c)},[`dragstart [data-${r}="${t}"]`]:(a={},c={})=>{r==="droppable"&&n.sortable&&(a.dataTransfer.effectAllowed="move",o=a.target,a.target.classList.add("is-dragging"),a.dataTransfer.setData("text/plain",null),a.dataTransfer.setDragImage(new Image,0,0)),n?.events?.onDragStart&&T(n.events.onDragStart)&&n.events.onDragStart(a,c)},[`drop [data-${r}="${t}"]`]:(a={},c={})=>{n?.events?.onDrop&&T(n.events.onDrop)&&n.events.onDrop(a,c)}}}}catch(o){i("component.renderMethods.dragDrop.attachEvents",o)}};var nr=class{constructor(r={}){N(r,this)}initHTML(r=""){let t=document.createElement("div");t.innerHTML=r?.trim()?.replace(/\n/g,"");let n=t.childNodes;if(n?.length>0){for(let o=0;o<n?.length;o+=1){let a=n[o],c=this.id||tr();a.setAttribute("draggable",!0),a.setAttribute("data-draggable",c),this.attachEvents(c,this.parent)}return t.innerHTML}}attachEvents(r="",t={}){let n=k(window.joystick._internal.tree,t.instanceId,"instanceId")?.instance||{};H(n,"draggable",r,{events:this.events})}},or=nr;var ir=class{constructor(r={}){N(r,this)}initHTML(r=""){let t=document.createElement("div");t.innerHTML=r?.trim()?.replace(/\n/g,"");let n=t.childNodes;if(n?.length>0){for(let o=0;o<n?.length;o+=1)n[o].setAttribute("data-droppable",this.name),this.attachEvents(this.name,this.parent);return t.innerHTML}}attachEvents(r="",t={}){let n=k(window.joystick._internal.tree,t.instanceId,"instanceId")?.instance||{};H(n,"droppable",r,{events:this.events,sortable:this.sortable})}},ar=ir;var sr=function(e="",r={}){try{let t=new or({...r,origin:this.name,parent:this.parent});return D()?e:t.initHTML(e,r?.id)}catch(t){i("component.renderMethods.dragDrop.draggable",t)}},qr=function(r="",t=null,n={}){try{let o=new ar({name:r,parent:this,...n});if(!t||t&&!T(t))throw Error("Second argument to droppable must be a callback function returning HTML.");return D()?t(sr.bind({name:r,parent:this})):o.initHTML(t(sr.bind({name:r,parent:this})))}catch(o){i("component.renderMethods.dragDrop",o)}},B=qr;var Wr=function(r=[],t=null){try{return T(t)&&r&&Array.isArray(r)?r.map((n,o)=>t(n,o)).join(""):""}catch(n){i("component.renderMethods.each",n)}},U=Wr;var Gr=function(r="",t={}){try{let n=D()?this.translations:window.__joystick_i18n__;if(!n||!n[r])return"";let o=Object.entries(t);return o.length>0?o.reduce((a,[c,p])=>a.replace(`{{${c}}}`,p),n[r]):n[r]}catch(n){i("component.renderMethods.i18n",n)}},q=Gr;var zr=function(r=!1,t=""){try{return this?.renderingHTMLWithDataForSSR||r?`<when>${t.trim()}</when>`:"<when> </when>"}catch(n){i("component.renderMethods.when",n)}},W=zr;var cr={c:$,component:$,d:B,dragDrop:B,e:U,each:U,i:q,i18n:q,w:W,when:W};var dr=(e={},r={})=>{try{return Object.entries(cr).reduce((t,[n,o])=>(t[n]=o.bind({...e,...r}),t),{})}catch(t){i("component.renderMethods.compile",t)}};var lr=(e={})=>{try{return Object.entries(e)?.reduce((r={},[t,n]={})=>(r[t]=n?.map((o={})=>({state:o?.state,children:lr(o?.children)})),r),{})}catch(r){i("component.render.getExistingStateMap.buildMapForChildren",r)}},pr=(e={})=>{try{return lr(e)}catch(r){i("component.render.getExistingStateMap",r)}};var ur=new RegExp(/\<\!\-\-(?:.|\n|\r)*?-->/g),Qr=new RegExp(/\n/g);var Vr=(e="")=>{try{return(e.match(ur)||[]).forEach(t=>{e=e.replace(t,"")}),e}catch(r){i("component.render.sanitizeHTML.removeCommentedCode",r)}},fr=(e="")=>{try{let r=`${e}`;return r=Vr(r),r}catch(r){i("component.render.sanitizeHTML",r)}};var mr=(e={},r="")=>{try{let{wrapper:t=null,ssrId:n=null,id:o=null,instanceId:a=null}=e;return`<div ${t?.id?`id="${t.id}" `:""}${t?.classList?`class="${t.classList?.join(" ")}" `:""}js-ssrId="${n}" js-c="${o}" js-i="${a}">${r}</div>`}catch(t){i("component.render.wrapHTML",t)}};var hr=(e={},r=[])=>{try{let t=[...r],n=Object.entries(e);for(let o=0;o<n?.length;o+=1){let[a,c]=n[o];for(let p=0;p<c?.length;p+=1){let x=c[p];Object.entries(x?.timers)?.length>0&&t.push(...Object.values(x?.timers)),Object.entries(x?.children)?.length>0&&hr(x?.children,t)}}if(t?.length>0)for(let o=0;o<t?.length;o+=1)clearTimeout(t[o])}catch(t){i("component.render.clearTimersOnChildren",t)}},gr=hr;var wr=(e={},r={})=>{try{r?.dataFromSSR&&(e.data=K(r.dataFromSSR,e.id)||{}),gr(e?.children);let t=pr(r?.existingChildren||e?.children)||{};e.children={},e.renderMethods=dr({...e,existingStateMap:t,translations:r?.translations||e.translations||{},ssrTree:r?.ssrTree,walkingTreeForSSR:r?.walkingTreeForSSR,renderingHTMLWithDataForSSR:r?.renderingHTMLWithDataForSSR,dataFromSSR:r?.dataFromSSR}),e.methods=Z(e,e.options.methods);let n=e.options.render({...e||{},setState:e.setState.bind(e),...e.renderMethods||{}}),o=fr(n),a=mr(e,o);return{unwrapped:o,wrapped:a}}catch(t){i("component.render.toHTML",t)}};var Kr=(e={})=>{try{return Object.values(e).reduce((r={},t)=>(r[t.name]=t.value,r),{})}catch(r){i("component.virtualDOM.build.parseAttributeMap",r)}},yr=(e={})=>{try{return e.tagName==="WHEN"?[].flatMap.call(e?.childNodes,r=>r?.tagName==="WHEN"?yr(r):G(r)):G(e)}catch(r){i("component.virtualDOM.build.flattenWhenTags",r)}},G=(e={})=>{try{let r=e&&e.tagName&&e.tagName.toLowerCase()||"text",t={tagName:r,attributes:Kr(e.attributes),children:[].flatMap.call(e.childNodes,n=>yr(n))};return r==="text"&&(t=e.textContent),t}catch(r){i("component.virtualDOM.build",r)}},xr=G;var Xr=(e="",r="")=>{try{let t=document.createElement("div");return t.setAttribute("js-c",r),t.innerHTML=e,t}catch(t){i("component.virtualDOM.build.convertHTMLToDOM",t)}},Mr=(e="",r="")=>{try{let t=Xr(e,r);return xr(t)}catch(t){i("component.virtualDOM.build",t)}};var br=(e="")=>{try{return document.createElement("div").setAttribute(e,"Test"),!0}catch{return!1}};var Jr=(e={})=>{try{let r=document.createElement(e.tagName),t=Object.entries(e.attributes);for(let n=0;n<t.length;n+=1){let[o,a]=t[n];br(o)&&r.setAttribute(o,a)}for(let n=0;n<e?.children?.length;n+=1){let o=e?.children[n];if(o){let a=Tr(o);r.appendChild(a)}}return r}catch(r){i("component.virtualDOM.renderTreeToDOM.renderElement",r)}},Tr=(e=null)=>{try{return V(e)?document.createTextNode(e):Jr(e)}catch(r){i("component.virtualDOM.renderTreeToDOM",r)}},Er=Tr;var R=(e={},r={})=>{try{let t=wr(e,{existingChildren:r?.existingChildren}),n=Mr(t.unwrapped,e.id),o=r.includeActual&&n?Er(n):null;return{html:t,virtual:n,actual:o}}catch(t){i("component.render.getUpdatedDOM",t)}};var sn=(e={})=>{try{let r=R(e,{includeActual:!0});return e.dom=r,r.actual}catch(r){i("component.render.forMount",r)}};export{sn as default};
