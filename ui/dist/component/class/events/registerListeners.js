var o=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var f=(e={})=>{try{return Object.entries(e).map(([t,n])=>{let[i,...c]=t.split(" ");return{type:i.toLowerCase(),selector:c.join(" "),handler:n}})}catch(t){o("component.events.serialize",t)}};var m=e=>{try{return typeof e=="function"}catch(t){o("types.isFunction",t)}};var h=(e={},t={})=>{try{e._joystick={...e?._joystick||{},listeners:[...e?._joystick?.listeners||[],t]}}catch(n){o("component.events.registerListeners.trackListenerOnElement",n)}},d=(e={},t={})=>{try{e._joystick={...e?._joystick||{},listeners:e?._joystick?.listeners?.filter((n={})=>n?.event?.type===t?.type)}}catch(n){o("component.events.registerListeners.trackListenerOnElement",n)}},x=(e={})=>{try{if(e.lifecycle&&e.lifecycle.onBeforeUnmount&&m(e.lifecycle.onBeforeUnmount)){let t=function(){e.lifecycle.onBeforeUnmount(e)};window.removeEventListener("beforeunload",t),window.addEventListener("beforeunload",t)}}catch(t){o("component.events.registerListeners.attachOnBeforeUnmount",t)}},u=(e={},t=[],n={})=>{let i=e.instance.options.events||e.instance.dragDrop?{...e.instance.options?.events||{},...e.instance.dragDrop?.events||{}}:{},c=Object.keys(i).length>0;if(x(e.instance),c&&t.push({id:e.id,instanceId:e.instance.instanceId,events:f(i).map(r=>{let s=document.querySelectorAll(`body [js-i="${e.instance.instanceId}"] ${r.selector}`);return{...r,eventListener:function(a){Object.defineProperty(a,"target",{value:a.composedPath()[0]}),r.handler(a,{...e.instance||{},setState:e?.instance?.setState.bind(e.instance),...n||{}})},elements:s?.length>0?s:[]}}),instance:e.instance}),e?.children?.length>0)for(let r=0;r<e?.children?.length;r+=1){let s=e?.children[r];u(s,t,n)}return t},F=(e={})=>{setTimeout(()=>{let t=u(window.joystick._internal.tree,[],e);for(let n=0;n<t?.length;n+=1){let i=t[n];for(let c=0;c<i?.events?.length;c+=1){let r=i.events[c];for(let s=0;s<r?.elements?.length;s+=1){let l=r.elements[s],a=l?._joystick?.listeners?.filter((p={})=>p?.type===r?.type);if(a?.length>0)for(let p=0;p<a?.length;p+=1){let y=a[p];l.removeEventListener(y?.type,y?.eventListener),d(l,y)}l.addEventListener(r.type,r.eventListener),h(l,r)}}}window.joystick._internal.eventListeners=t},0)};export{F as default};
