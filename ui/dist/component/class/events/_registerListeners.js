var c=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var p=(e={})=>{try{return Object.entries(e).map(([t,r])=>{let[s,...i]=t.split(" ");return{type:s.toLowerCase(),selector:i.join(" "),handler:r}})}catch(t){c("component.events.serialize",t)}};var l=e=>{try{return typeof e=="function"}catch(t){c("types.isFunction",t)}};var f=(e={})=>{try{if(e.lifecycle&&e.lifecycle.onBeforeUnmount&&l(e.lifecycle.onBeforeUnmount)){let t=function(){e.lifecycle.onBeforeUnmount(e)};window.removeEventListener("beforeunload",t),window.addEventListener("beforeunload",t)}}catch(t){c("component.events.registerListeners.attachOnBeforeUnmount",t)}},y=(e={},t=[],r={})=>{let s=e.instance.options.events||e.instance.dragDrop?{...e.instance.options?.events||{},...e.instance.dragDrop?.events||{}}:{},i=Object.keys(s).length>0;if(f(e.instance),i&&t.push({id:e.id,instanceId:e.instance.instanceId,events:p(s).map(n=>{let o=document.querySelectorAll(`body [js-i="${e.instance.instanceId}"] ${n.selector}`);return{...n,eventListener:function(a){Object.defineProperty(a,"target",{value:a.composedPath()[0]}),n.handler(a,{...e.instance||{},setState:e?.instance?.setState.bind(e.instance),...r||{}})},elements:o?.length>0?o:[]}}),instance:e.instance}),e?.children?.length>0)for(let n=0;n<e?.children?.length;n+=1){let o=e?.children[n];y(o,t,r)}return t},j=(e={})=>{setTimeout(()=>{let t=y(window.joystick._internal.tree,[],e);for(let r=0;r<t?.length;r+=1){let s=t[r];for(let i=0;i<s?.events?.length;i+=1){let n=s.events[i];for(let o=0;o<n?.elements?.length;o+=1)n.elements[o].addEventListener(n.type,n.eventListener)}}window.joystick._internal.eventListeners=t},0)};export{j as default};
