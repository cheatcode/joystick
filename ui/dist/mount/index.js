var o=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var p=e=>{try{return e instanceof Element}catch(t){o("types.isDOM",t)}};var c=e=>{try{return typeof e=="function"}catch(t){o("types.isFunction",t)}};var a=e=>{try{return!!(e&&typeof e=="object"&&!Array.isArray(e))}catch(t){o("types.isObject",t)}};var m=(e={})=>{try{window.joystick._internal.tree={id:e?.id||null,instanceId:e?.instanceId||null,instance:e,children:[]}}catch(t){o("mount.initializeJoystickComponentTree",t)}};var d=()=>typeof window=="undefined";var b=(e="")=>{try{let[t,i]=e?.split(".");return i?window?.joystick?._internal?.queues[t][i]:window?.joystick?._internal?.queues[t]}catch(t){o("processQueue.getQueue",t)}},l=(e="",t=null)=>{try{d()||(b(e)||{}).process(t)}catch(i){o("processQueue",i)}};var y=(e={},t=null)=>{try{return e.innerHTML="",e.appendChild(t),t}catch(i){o("mount.appendToDOM",i)}};var f=(e={})=>{try{return Object.entries(e).map(([t,i])=>{let[n,...r]=t.split(" ");return{type:n.toLowerCase(),selector:r.join(" "),handler:i}})}catch(t){o("component.events.serialize",t)}};var k=(e={})=>{try{if(e.lifecycle&&e.lifecycle.onBeforeUnmount&&c(e.lifecycle.onBeforeUnmount)){let t=function(){e.lifecycle.onBeforeUnmount(e)};window.removeEventListener("beforeunload",t),window.addEventListener("beforeunload",t)}}catch(t){o("component.events.registerListeners.attachOnBeforeUnmount",t)}},h=(e={},t=[])=>{let i=e.instance.options.events||{},n=Object.keys(i).length>0;if(k(e.instance),n&&t.push({id:e.id,instanceId:e.instance.instanceId,events:f(i).map(r=>{let s=document.querySelectorAll(`body [js-i="${e.instance.instanceId}"] ${r.selector}`),x=document.querySelectorAll(`body [js-c="${e.id}"] ${r.selector}`);return{...r,eventListener:function(u){Object.defineProperty(u,"target",{value:u.composedPath()[0]}),r.handler(u,e.instance)},elements:s?.length>0?s:[]}}),instance:e.instance}),e?.children?.length>0)for(let r=0;r<e?.children?.length;r+=1){let s=e?.children[r];h(s,t)}return t},w=()=>{setTimeout(()=>{let e=h(window.joystick._internal.tree,[]);for(let t=0;t<e?.length;t+=1){let i=e[t];for(let n=0;n<i?.events?.length;n+=1){let r=i.events[n];for(let s=0;s<r?.elements?.length;s+=1)r.elements[s].addEventListener(r.type,r.eventListener)}}window.joystick._internal.eventListeners=e},0)};var H=(e=null,t={},i=null)=>{try{c(e)||o("mount","Component to mount must be a function."),a(t)||o("mount","props must be an object."),p(i)||o("mount","target must be a DOM node.");let n=e({props:t});m(n);let r=n.render({mounting:!0});r&&(r.setAttribute("js-ssrId",n.ssrId),r.setAttribute("js-c",n.id),r.setAttribute("js-i",n.instanceId)),n.lifecycle.onBeforeMount(),l("lifecycle.onBeforeMount"),y(i,r),n.setDOMNodeOnInstance(),n.appendCSSToHead(),w(),n.lifecycle.onMount(),l("lifecycle.onMount")}catch(n){o("mount",n)}};export{H as default};
