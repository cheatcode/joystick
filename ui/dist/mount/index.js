var r=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var f=e=>{try{return e instanceof Element}catch(t){r("types.isDOM",t)}};var l=e=>{try{return typeof e=="function"}catch(t){r("types.isFunction",t)}};var d=e=>{try{return!!(e&&typeof e=="object"&&!Array.isArray(e))}catch(t){r("types.isObject",t)}};var h=(e={})=>{try{window.joystick._internal.tree={id:e?.id||null,instanceId:e?.instanceId||null,instance:e,children:[]}}catch(t){r("mount.initializeJoystickComponentTree",t)}};var w=()=>typeof window=="undefined";var j=(e="")=>{try{let[t,n]=e?.split(".");return n?window?.joystick?._internal?.queues[t][n]:window?.joystick?._internal?.queues[t]}catch(t){r("processQueue.getQueue",t)}},y=(e="",t=null)=>{try{w()||(j(e)||{}).process(t)}catch(n){r("processQueue",n)}};var x=(e={},t=null)=>{try{return e.innerHTML="",e.appendChild(t),t}catch(n){r("mount.appendToDOM",n)}};var k=(e={})=>{try{return Object.entries(e).map(([t,n])=>{let[o,...s]=t.split(" ");return{type:o.toLowerCase(),selector:s.join(" "),handler:n}})}catch(t){r("component.events.serialize",t)}};var E=(e={},t={})=>{try{e._joystick={...e?._joystick||{},listeners:[...e?._joystick?.listeners||[],t]}}catch(n){r("component.events.registerListeners.trackListenerOnElement",n)}},F=(e={},t={})=>{try{e._joystick={...e?._joystick||{},listeners:e?._joystick?.listeners?.filter((n={})=>n?.event?.type===t?.type)}}catch(n){r("component.events.registerListeners.trackListenerOnElement",n)}},L=(e={})=>{try{if(e.lifecycle&&e.lifecycle.onBeforeUnmount&&l(e.lifecycle.onBeforeUnmount)){let t=function(){e.lifecycle.onBeforeUnmount(e)};window.removeEventListener("beforeunload",t),window.addEventListener("beforeunload",t)}}catch(t){r("component.events.registerListeners.attachOnBeforeUnmount",t)}},b=(e={},t=[],n={})=>{let o=e.instance.options.events||e.instance.dragDrop?{...e.instance.options?.events||{},...e.instance.dragDrop?.events||{}}:{},s=Object.keys(o).length>0;if(L(e.instance),s&&t.push({id:e.id,instanceId:e.instance.instanceId,events:k(o).map(i=>{let c=document.querySelectorAll(`body [js-i="${e.instance.instanceId}"] ${i.selector}`);return{...i,eventListener:function(a){Object.defineProperty(a,"target",{value:a.composedPath()[0]}),i.handler(a,{...e.instance||{},setState:e?.instance?.setState.bind(e.instance),...n||{}})},elements:c?.length>0?c:[]}}),instance:e.instance}),e?.children?.length>0)for(let i=0;i<e?.children?.length;i+=1){let c=e?.children[i];b(c,t,n)}return t},g=(e={})=>{setTimeout(()=>{let t=b(window.joystick._internal.tree,[],e);for(let n=0;n<t?.length;n+=1){let o=t[n];for(let s=0;s<o?.events?.length;s+=1){let i=o.events[s];for(let c=0;c<i?.elements?.length;c+=1){let p=i.elements[c],a=p?._joystick?.listeners?.filter((u={})=>u?.type===i?.type);if(a?.length>0)for(let u=0;u<a?.length;u+=1){let m=a[u];p.removeEventListener(m?.type,m?.eventListener),F(p,m)}p.addEventListener(i.type,i.eventListener),E(p,i)}}}window.joystick._internal.eventListeners=t},0)};var V=(e=null,t={},n=null)=>{try{l(e)||r("mount","Component to mount must be a function."),d(t)||r("mount","props must be an object."),f(n)||r("mount","target must be a DOM node.");let o=e({props:t});h(o);let s=o.render({mounting:!0});s&&(s.setAttribute("js-ssrId",o.ssrId),s.setAttribute("js-c",o.id),s.setAttribute("js-i",o.instanceId)),o.lifecycle.onBeforeMount(),y("lifecycle.onBeforeMount"),x(n,s),o.setDOMNodeOnInstance(),o.appendCSSToHead(),g(o.renderMethods),o.lifecycle.onMount(),y("lifecycle.onMount")}catch(o){r("mount",o)}};export{V as default};
