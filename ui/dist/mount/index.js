var n=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var l=e=>{try{return e instanceof Element}catch(t){n("types.isDOM",t)}};var u=e=>{try{return typeof e=="function"}catch(t){n("types.isFunction",t)}};var m=e=>{try{return!!(e&&typeof e=="object"&&!Array.isArray(e))}catch(t){n("types.isObject",t)}};var d=(e={})=>{try{window.joystick._internal.tree={id:e?.id||null,instanceId:e?.instanceId||null,instance:e,children:[]}}catch(t){n("mount.initializeJoystickComponentTree",t)}};var f=()=>typeof window=="undefined";var k=(e="")=>{try{let[t,o]=e?.split(".");return o?window?.joystick?._internal?.queues[t][o]:window?.joystick?._internal?.queues[t]}catch(t){n("processQueue.getQueue",t)}},p=(e="",t=null)=>{try{f()||(k(e)||{}).process(t)}catch(o){n("processQueue",o)}};var y=(e={},t=null)=>{try{return e.innerHTML="",e.appendChild(t),t}catch(o){n("mount.appendToDOM",o)}};var h=(e={})=>{try{return Object.entries(e).map(([t,o])=>{let[r,...i]=t.split(" ");return{type:r.toLowerCase(),selector:i.join(" "),handler:o}})}catch(t){n("component.events.serialize",t)}};var g=(e={})=>{try{if(e.lifecycle&&e.lifecycle.onBeforeUnmount&&u(e.lifecycle.onBeforeUnmount)){let t=function(){e.lifecycle.onBeforeUnmount(e)};window.removeEventListener("beforeunload",t),window.addEventListener("beforeunload",t)}}catch(t){n("component.events.registerListeners.attachOnBeforeUnmount",t)}},w=(e={},t=[],o={})=>{let r=e.instance.options.events||{},i=Object.keys(r).length>0;if(g(e.instance),i&&t.push({id:e.id,instanceId:e.instance.instanceId,events:h(r).map(s=>{let c=document.querySelectorAll(`body [js-i="${e.instance.instanceId}"] ${s.selector}`);return{...s,eventListener:function(a){Object.defineProperty(a,"target",{value:a.composedPath()[0]}),s.handler(a,{...e.instance||{},setState:e?.instance?.setState.bind(e.instance),...o||{}})},elements:c?.length>0?c:[]}}),instance:e.instance}),e?.children?.length>0)for(let s=0;s<e?.children?.length;s+=1){let c=e?.children[s];w(c,t,o)}return t},x=(e={})=>{setTimeout(()=>{let t=w(window.joystick._internal.tree,[],e);for(let o=0;o<t?.length;o+=1){let r=t[o];for(let i=0;i<r?.events?.length;i+=1){let s=r.events[i];for(let c=0;c<s?.elements?.length;c+=1)s.elements[c].addEventListener(s.type,s.eventListener)}}window.joystick._internal.eventListeners=t},0)};var H=(e=null,t={},o=null)=>{try{u(e)||n("mount","Component to mount must be a function."),m(t)||n("mount","props must be an object."),l(o)||n("mount","target must be a DOM node.");let r=e({props:t});d(r);let i=r.render({mounting:!0});i&&(i.setAttribute("js-ssrId",r.ssrId),i.setAttribute("js-c",r.id),i.setAttribute("js-i",r.instanceId)),r.lifecycle.onBeforeMount(),p("lifecycle.onBeforeMount"),y(o,i),r.setDOMNodeOnInstance(),r.appendCSSToHead(),x(r.renderMethods),r.lifecycle.onMount(),p("lifecycle.onMount")}catch(r){n("mount",r)}};export{H as default};
