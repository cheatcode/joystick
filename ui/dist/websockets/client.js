var d=(e="",t={})=>{throw new Error(`[joystick${e?`.${e}`:""}] ${t.message||t.reason||t}`)};var c=(e="",t=[])=>{typeof window!="undefined"&&!!window.__joystick_test__&&(window.test={...window.test||{},functionCalls:{...window?.test?.functionCalls||{},[e]:[...window?.test?.functionCalls&&window?.test?.functionCalls[e]||[],{calledAt:new Date().toISOString(),args:t}]}})};var w="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890".split(""),a=(e=16)=>{let t="",s=0;for(;s<e;)t+=w[Math.floor(Math.random()*(w.length-1))],s+=1;return t};var o=null,i=0,u=(e={},t=null)=>{try{if(window?.__joystick_test__)return t();let s=e?.url;e?.query&&(s=`${s}?${new URLSearchParams(e.query).toString()}`);let l=new WebSocket(s);o&&(clearInterval(o),o=null);let r={client:l,send:(n={})=>(c(`ui.websockets.${e?.test?.name||a()}.send`,[n]),l.send(JSON.stringify(n)))};return l.addEventListener("open",()=>{e?.options?.logging&&console.log(`[joystick.websockets] Connected to ${e?.url}`),e?.events?.onOpen&&(e.events.onOpen(r),c(`ui.websockets.${e?.test?.name||a()}.onOpen`,[r])),i=0}),l.addEventListener("message",n=>{n?.data&&e?.events?.onMessage&&(e.events.onMessage(JSON.parse(n.data||{}),r),c(`ui.websockets.${e?.test?.name||a()}.onMessage`,[n.data||{},r]))}),l.addEventListener("close",n=>{e?.options?.logging&&console.log(`[joystick.websockets] Disconnected from ${e?.url}`),e?.events?.onClose&&(e.events.onClose(n?.code,n?.reason,r),c(`ui.websockets.${e?.test?.name||a()}.onClose`,[n.data||{},r])),l=null;let f=[1e3,1001].includes(n?.code);e?.options?.autoReconnect&&!o&&!f&&(o=setInterval(()=>{l=null,i<(e?.options?.reconnectAttempts||12)?(u(e,t),e?.options?.logging&&console.log(`[joystick.websockets] Attempting to reconnect (${i+1}/12)...`),i+=1):clearInterval(o)},e?.options?.reconnectDelayInSeconds*1e3||5e3))}),t&&t(r),r}catch(s){d("websockets.client",s)}},C=u;export{C as default};
