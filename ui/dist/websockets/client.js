var T=Object.create;var m=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var W=r=>m(r,"__esModule",{value:!0});var g=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var _=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of J(e))!Q.call(r,n)&&n!=="default"&&m(r,n,{get:()=>e[n],enumerable:!(t=H(e,n))||t.enumerable});return r},z=r=>_(W(m(r!=null?T(k(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var b=g((ar,h)=>{"use strict";h.exports=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)});var j=g((cr,O)=>{"use strict";var x="%[a-f0-9]{2}",S=new RegExp(x,"gi"),w=new RegExp("("+x+")+","gi");function y(r,e){try{return decodeURIComponent(r.join(""))}catch{}if(r.length===1)return r;e=e||1;var t=r.slice(0,e),n=r.slice(e);return Array.prototype.concat.call([],y(t),y(n))}function G(r){try{return decodeURIComponent(r)}catch{for(var e=r.match(S),t=1;t<e.length;t++)r=y(e,t).join(""),e=r.match(S);return r}}function K(r){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=w.exec(r);t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{var n=G(t[0]);n!==t[0]&&(e[t[0]]=n)}t=w.exec(r)}e["%C2"]="\uFFFD";for(var a=Object.keys(e),f=0;f<a.length;f++){var c=a[f];r=r.replace(new RegExp(c,"g"),e[c])}return r}O.exports=function(r){if(typeof r!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof r+"`");try{return r=r.replace(/\+/g," "),decodeURIComponent(r)}catch{return K(r)}}});var $=g((fr,E)=>{"use strict";E.exports=(r,e)=>{if(!(typeof r=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[r];let t=r.indexOf(e);return t===-1?[r]:[r.slice(0,t),r.slice(t+e.length)]}});var N=g((sr,A)=>{"use strict";A.exports=function(r,e){for(var t={},n=Object.keys(r),a=Array.isArray(e),f=0;f<n.length;f++){var c=n[f],i=r[c];(a?e.indexOf(c)!==-1:e(c,i,r))&&(t[c]=i)}return t}});var L=g(d=>{"use strict";var X=b(),Y=j(),I=$(),Z=N(),v=r=>r==null,F=Symbol("encodeFragmentIdentifier");function rr(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{let a=t.length;return n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[s(e,r),"[",a,"]"].join("")]:[...t,[s(e,r),"[",s(a,r),"]=",s(n,r)].join("")]};case"bracket":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[s(e,r),"[]"].join("")]:[...t,[s(e,r),"[]=",s(n,r)].join("")];case"colon-list-separator":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[s(e,r),":list="].join("")]:[...t,[s(e,r),":list=",s(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{let e=r.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||r.skipNull&&a===null||r.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[s(t,r),e,s(a,r)].join("")]:[[n,s(a,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,s(e,r)]:[...t,[s(e,r),"=",s(n,r)].join("")]}}function er(r){let e;switch(r.arrayFormat){case"index":return(t,n,a)=>{if(e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!e){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][e[1]]=n};case"bracket":return(t,n,a)=>{if(e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!e){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let f=typeof n=="string"&&n.includes(r.arrayFormatSeparator),c=typeof n=="string"&&!f&&l(n,r).includes(r.arrayFormatSeparator);n=c?l(n,r):n;let i=f||c?n.split(r.arrayFormatSeparator).map(B=>l(B,r)):n===null?n:l(n,r);a[t]=i};case"bracket-separator":return(t,n,a)=>{let f=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!f){a[t]=n&&l(n,r);return}let c=n===null?[]:n.split(r.arrayFormatSeparator).map(i=>l(i,r));if(a[t]===void 0){a[t]=c;return}a[t]=[].concat(a[t],c)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function C(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function s(r,e){return e.encode?e.strict?X(r):encodeURIComponent(r):r}function l(r,e){return e.decode?Y(r):r}function q(r){return Array.isArray(r)?r.sort():typeof r=="object"?q(Object.keys(r)).sort((e,t)=>Number(e)-Number(t)).map(e=>r[e]):r}function U(r){let e=r.indexOf("#");return e!==-1&&(r=r.slice(0,e)),r}function tr(r){let e="",t=r.indexOf("#");return t!==-1&&(e=r.slice(t)),e}function p(r){r=U(r);let e=r.indexOf("?");return e===-1?"":r.slice(e+1)}function D(r,e){return e.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?r=Number(r):e.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")&&(r=r.toLowerCase()==="true"),r}function R(r,e){e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e),C(e.arrayFormatSeparator);let t=er(e),n=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return n;for(let a of r.split("&")){if(a==="")continue;let[f,c]=I(e.decode?a.replace(/\+/g," "):a,"=");c=c===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?c:l(c,e),t(l(f,e),c,n)}for(let a of Object.keys(n)){let f=n[a];if(typeof f=="object"&&f!==null)for(let c of Object.keys(f))f[c]=D(f[c],e);else n[a]=D(f,e)}return e.sort===!1?n:(e.sort===!0?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((a,f)=>{let c=n[f];return Boolean(c)&&typeof c=="object"&&!Array.isArray(c)?a[f]=q(c):a[f]=c,a},Object.create(null))}d.extract=p;d.parse=R;d.stringify=(r,e)=>{if(!r)return"";e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),C(e.arrayFormatSeparator);let t=c=>e.skipNull&&v(r[c])||e.skipEmptyString&&r[c]==="",n=rr(e),a={};for(let c of Object.keys(r))t(c)||(a[c]=r[c]);let f=Object.keys(a);return e.sort!==!1&&f.sort(e.sort),f.map(c=>{let i=r[c];return i===void 0?"":i===null?s(c,e):Array.isArray(i)?i.length===0&&e.arrayFormat==="bracket-separator"?s(c,e)+"[]":i.reduce(n(c),[]).join("&"):s(c,e)+"="+s(i,e)}).filter(c=>c.length>0).join("&")};d.parseUrl=(r,e)=>{e=Object.assign({decode:!0},e);let[t,n]=I(r,"#");return Object.assign({url:t.split("?")[0]||"",query:R(p(r),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:l(n,e)}:{})};d.stringifyUrl=(r,e)=>{e=Object.assign({encode:!0,strict:!0,[F]:!0},e);let t=U(r.url).split("?")[0]||"",n=d.extract(r.url),a=d.parse(n,{sort:!1}),f=Object.assign(a,r.query),c=d.stringify(f,e);c&&(c=`?${c}`);let i=tr(r.url);return r.fragmentIdentifier&&(i=`#${e[F]?s(r.fragmentIdentifier,e):r.fragmentIdentifier}`),`${t}${c}${i}`};d.pick=(r,e,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[F]:!1},t);let{url:n,query:a,fragmentIdentifier:f}=d.parseUrl(r,t);return d.stringifyUrl({url:n,query:Z(a,e),fragmentIdentifier:f},t)};d.exclude=(r,e,t)=>{let n=Array.isArray(e)?a=>!e.includes(a):(a,f)=>!e(a,f);return d.pick(r,n,t)}});var P=z(L());var M=(r="",e={})=>{throw new Error(`[joystick${r?`.${r}`:""}] ${e.message||e.reason||e}`)};var u=null,o=0,V=(r={},e=null)=>{try{let t=r?.url;r.queryParams&&(t=`${t}?${P.default.stringify(r.queryParams)}`);let n=new WebSocket(t);u&&(clearInterval(u),u=null),n.addEventListener("open",()=>{r?.logging&&console.log(`[websockets] Connected to ${r?.url}`),o=0}),n.addEventListener("message",f=>{f?.data&&r.onMessage&&r.onMessage(JSON.parse(f.data))}),n.addEventListener("close",()=>{r?.logging&&console.log(`[websockets] Disconnected from ${r?.url}`),n=null,r.autoReconnect&&!u&&(u=setInterval(()=>{n=null,o<12?(V(r,e),r?.logging&&console.log(`[websockets] Attempting to reconnect (${o+1}/12)...`),o+=1):clearInterval(u)},5e3))});let a={client:n,send:(f={})=>(r.queryParams&&(f={...f,...r.queryParams}),n.send(JSON.stringify(f)))};return e&&e(a),a}catch(t){M("websockets.client",t)}},ur=V;export{ur as default};
